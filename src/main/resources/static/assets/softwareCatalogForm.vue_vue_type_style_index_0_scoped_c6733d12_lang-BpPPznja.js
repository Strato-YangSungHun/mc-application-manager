import{c as Z}from"./IconPlus-BsoFqKh6.js";import{d as ee,u as te,c as ae,r,o as le,a as s,b as l,t as m,j as k,e as p,v as g,F as b,f as w,g as U,l as j,h as n}from"./index-cGYgHUXR.js";import{_ as se}from"./lodash-DmtNlwZV.js";import{s as i}from"./request-D5zYu6ie.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";/**
 * @license @tabler/icons-vue v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var rt=Z("outline","search","IconSearch",[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]]);const oe=()=>i.get("/cbtumblebug/ns"),ie=a=>i.get(`/cbtumblebug/ns/${a}/mci`),ue=a=>i.get(`/cbtumblebug/ns/${a.nsId}/mci/${a.mciId}`),ce=a=>i.get(`/cbtumblebug/ns/${a}/k8scluster`),re=a=>i.get(`/catalog/software?name=${a}`),dt=a=>i.get(`/catalog/software/${a}`),pt=a=>i.get(`/search/dockerhub/${a}`),mt=a=>i.get(`/search/artifacthub/${a}`),de=a=>i.get(`/applications/vm/deploy?namespace=${a.namespace}&mciId=${a.mciId}&vmId=${a.vmId}&catalogId=${a.catalogId}&servicePort=${a.servicePort}`),pe=a=>i.get(`/applications/vm/action?operation=${a.operation}&applicationStatusId=${a.applicationStatusId}&reason=${a.reason}`),me=a=>i.get(`/applications/k8s/deploy?namespace=${a.namespace}&clusterName=${a.clusterName}&catalogId=${a.catalogId}`),ve=a=>i.get(`/applications/k8s/action?operation=${a.operation}&applicationStatusId=${a.applicationStatusId}&reason=${a.reason}`),fe=a=>i.get(`/applications/vm/check?namespace=${a.namespace}&mciId=${a.mciName}&vmId=${a.vmName}&catalogId=${a.catalogId}`),ge=a=>i.get(`/applications/k8s/check?namespace=${a.namespace}&clusterName=${a.clusterName}&catalogId=${a.catalogId}`),vt=a=>i.get(`/ape/log/${a}`);function ft(a){return i.post("/catalog/software",a)}function gt(a){return i.put(`/catalog/software/${a.id}`,a)}function bt(a){return i.delete(`/catalog/software/${a}`)}function ht(){return i.get("/applications/groups")}function yt(a){return i.post("/catalog/application/category",a)}function It(a){return i.post("/catalog/application/package",a)}function kt(a){const v={target:a.target,applicationName:a.packageName};return i.post("/catalog/application/package/version",v)}function wt(a){return i.get(`/search/dockerhub/${a.path}`)}function Ct(a){return i.post("/catalog/docker/register",a)}function St(a){return i.post("/artifacthub/register",a)}const be={class:"modal fade",id:"install-form",tabindex:"-1"},he={class:"modal-dialog modal-lg",role:"document"},ye={class:"modal-content"},Ie={class:"modal-header"},ke={class:"modal-title"},we={class:"modal-body",style:{"max-height":"calc(100vh - 200px)","overflow-y":"auto"}},Ce={class:"mb-3"},Se={key:0,class:"text-muted"},Ve={key:1,class:"text-muted"},Ae=["value"],Ne={class:"mb-3"},$e={key:0,class:"text-muted"},Ue={key:1,class:"text-muted"},_e=["value"],Me={value:"selectNsId"},xe={class:"mb-3"},Le={key:0,class:"text-muted"},Pe={key:1,class:"text-muted"},Re=["disabled"],Ee=["value"],Fe={class:"mb-3"},Ke=["disabled"],Te=["value"],De={class:"mb-3"},Be={class:"mb-3"},je={class:"mb-3"},ze={key:0,class:"text-muted"},He={key:1,class:"text-muted"},qe=["value"],Ye={value:"selectNsId"},Oe={class:"mb-3"},We={key:0,class:"text-muted"},Ge={key:1,class:"text-muted"},Je=["disabled"],Qe=["value"],Xe={class:"mb-3"},Ze={key:0,class:"mb-3"},et={class:"d-flex justigy-content-between"},tt={class:"modal-footer d-flex justify-content-between"},at=["disabled"],lt=["disabled"],st=ee({__name:"applicationInstallationForm",props:{nsId:{},title:{}},setup(a){const v=te(),z=a,c=ae(()=>z.title),F=r([]),C=r([]),N=r([]),L=r([]),_=r([]),d=r(""),u=r(""),f=r(""),y=r(""),h=r({}),M=r([]),S=r(""),V=r(""),P=r(""),I=r(!0);le(async()=>{document.getElementById("install-form").addEventListener("show.bs.modal",async()=>{await R(),await H()})});const R=async()=>{d.value="",u.value="",f.value="",y.value="",h.value={},q(),Y(),await O()},H=async()=>{await re("").then(({data:o})=>{_.value=o})},q=()=>{F.value=[{key:"VM",value:"VM"},{key:"k8s",value:"K8S"}]},Y=()=>{c.value==="Application Uninstallation"?I.value=!1:I.value=!0},O=async()=>{await oe().then(async({data:o})=>{C.value=o,C.value.length>0&&(u.value=C.value[0].name),se.isEmpty(u.value)||(d.value==="VM"?await K():d.value==="K8S"&&await D())})},K=async()=>{await ie(u.value).then(async({data:o})=>{N.value=o,N.value.length>0?(f.value=N.value[0].name,await T()):f.value=""})},T=async()=>{const o={nsId:u.value,mciId:f.value};await ue(o).then(({data:e})=>{L.value=e.vm,N.value.length>0?y.value=L.value[0].name:y.value=""})},D=async()=>{await ce(u.value).then(({data:o})=>{M.value=o,M.value.length>0?S.value=M.value[0].name:S.value=""})},E=async()=>{await K(),x()},W=async()=>{await T(),x()},G=async()=>{await D(),x()},x=()=>{c.value==="Application Installation"?I.value=!0:c.value==="Application Uninstallation"&&(I.value=!1)},J=async()=>{let o={},e={};d.value==="VM"?(V.value.split(",").map(t=>t.toLowerCase().trim()),o={namespace:u.value,mciId:f.value,vmId:y.value,catalogId:A.value,servicePort:P.value},c.value=="Application Installation"?e=await de(o):e=await pe(o),e.data?v.success("SUCCESS"):v.error("FAIL")):d.value==="K8S"&&(V.value.split(",").map(t=>t.toLowerCase().trim()),o={namespace:u.value,clusterName:S.value,catalogId:A.value},c.value=="Application Installation"?e=await me(o):e=await ve(o),e.data?v.success("SUCCESS"):v.error("FAIL"))},Q=async()=>{d.value==="VM"||d.value==="K8S"?X().then(o=>{let e=!0;if(o===null){v.error("Please select all items");return}else if(o===!1){let t="";d.value==="VM"?t="VM":d.value==="K8S"&&(t="CLUSTER");const $="Your selected "+t+" has lower specifications than recommended. Would you like to continue with the installation?";e=confirm($)}e&&(v.success("Please click RUN"),I.value=!1)}):v.error("Please Select Infra")},X=async()=>{let o=!1;if(d.value==="VM"){if(u.value===""||f.value===""||y.value===""||A.value===0)return null;{const e={namespace:u.value,mciName:f.value,vmName:y.value,catalogId:A.value};await fe(e).then(({data:t})=>{o=t})}}else if(d.value==="K8S"){if(u.value===""||S.value===""||A.value===0){v.error("Please select all items");return}const e={namespace:u.value,clusterName:S.value,catalogId:A.value};await ge(e).then(({data:t})=>{o=t})}return o},A=r(0),B=()=>{c.value==="Application Installation"&&(I.value=!0),_.value.forEach(o=>{if(V.value===o.name){A.value=o.id;return}})};return(o,e)=>(n(),s("div",be,[l("div",he,[l("div",ye,[l("div",Ie,[l("h5",ke,m(c.value),1),l("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:R})]),l("div",we,[l("div",Ce,[e[15]||(e[15]=l("label",{class:"form-label"},"Target Infra",-1)),c.value=="Application Installation"?(n(),s("p",Se," Select the Infra what is the Infra will be installed ")):c.value=="Application Uninstallation"?(n(),s("p",Ve," Select the Infra what is the Infra will be uninstalled ")):k("",!0),p(l("select",{class:"form-select",id:"infra","onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),onClick:x},[(n(!0),s(b,null,w(F.value,t=>(n(),s("option",{value:t.value,key:t.value},m(t.value),9,Ae))),128))],512),[[g,d.value]])]),d.value=="VM"?(n(),s(b,{key:0},[l("div",Ne,[e[16]||(e[16]=l("label",{class:"form-label"},"Namespace",-1)),c.value=="Application Installation"?(n(),s("p",$e," Select the namespace where the application will be installed")):c.value=="Application Uninstallation"?(n(),s("p",Ue," Select the namespace where the application will be uninstalled")):k("",!0),C.value.length>0?p((n(),s("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[1]||(e[1]=t=>u.value=t),onChange:E},[(n(!0),s(b,null,w(C.value,t=>(n(),s("option",{value:t.name,key:t.name},m(t.name),9,_e))),128))],544)),[[g,u.value]]):p((n(),s("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[2]||(e[2]=t=>u.value=t),onChange:E},[l("option",Me,m(u.value),1)],544)),[[g,u.value]])]),l("div",xe,[e[17]||(e[17]=l("label",{class:"form-label"},"MCI Name",-1)),c.value=="Application Installation"?(n(),s("p",Le," Select the multi-cloud infrastructure information where the application will be deployed")):c.value=="Application Uninstallation"?(n(),s("p",Pe," Remove the application and associated resources from the multi-cloud infrastructure")):k("",!0),p(l("select",{class:"form-select",id:"mci-name",disabled:u.value=="","onUpdate:modelValue":e[3]||(e[3]=t=>f.value=t),onChange:W},[(n(!0),s(b,null,w(N.value,t=>(n(),s("option",{value:t.id,key:t.name},m(t.name),9,Ee))),128))],40,Re),[[g,f.value]])]),l("div",Fe,[e[18]||(e[18]=l("label",{class:"form-label"},"VM Name",-1)),e[19]||(e[19]=l("p",{class:"text-muted"}," Select the virtual machine (VM) within the chosen multi-cloud infrastructure where the application will be deployed",-1)),p(l("select",{class:"form-select",id:"mci-name",disabled:f.value=="","onUpdate:modelValue":e[4]||(e[4]=t=>y.value=t)},[(n(!0),s(b,null,w(L.value,t=>(n(),s("option",{value:t.id,key:t.name},m(t.name),9,Te))),128))],8,Ke),[[g,y.value]])]),l("div",De,[e[20]||(e[20]=l("label",{class:"form-label"},"Application",-1)),e[21]||(e[21]=l("p",{class:"text-muted"},"Select the application",-1)),p(l("select",{class:"form-select","onUpdate:modelValue":e[5]||(e[5]=t=>V.value=t),onChange:B},[(n(!0),s(b,null,w(_.value,(t,$)=>(n(),s("option",{key:$},m(t.name),1))),128))],544),[[g,V.value]])]),l("div",Be,[e[22]||(e[22]=l("label",{class:"form-label"},"Port",-1)),e[23]||(e[23]=l("p",{class:"text-muted"},"Please enter a port accessible from the outside",-1)),p(l("input",{type:"number",class:"form-control",placeholder:"8080","onUpdate:modelValue":e[6]||(e[6]=t=>P.value=t)},null,512),[[U,P.value]])])],64)):d.value=="K8S"?(n(),s(b,{key:1},[l("div",je,[e[24]||(e[24]=l("label",{class:"form-label"},"Namespace",-1)),c.value=="Application Installation"?(n(),s("p",ze,"Select the namespace where the application will be installed")):c.value=="Application Uninstallation"?(n(),s("p",He,"Select the namespace where the application will be uninstalled")):k("",!0),C.value.length>0?p((n(),s("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[7]||(e[7]=t=>u.value=t),onChange:G},[(n(!0),s(b,null,w(C.value,t=>(n(),s("option",{value:t.name,key:t.name},m(t.name),9,qe))),128))],544)),[[g,u.value]]):p((n(),s("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[8]||(e[8]=t=>u.value=t),onChange:E},[l("option",Ye,m(u.value),1)],544)),[[g,u.value]])]),l("div",Oe,[e[25]||(e[25]=l("label",{class:"form-label"},"ClusterName",-1)),c.value=="Application Installation"?(n(),s("p",We,"Select the name of the cluster where the application will be deployed")):c.value=="Application Uninstallation"?(n(),s("p",Ge,"Remove the application and associated resources from the multi-cloud infrastructure")):k("",!0),p(l("select",{class:"form-select",id:"mci-name",disabled:u.value=="","onUpdate:modelValue":e[9]||(e[9]=t=>S.value=t)},[(n(!0),s(b,null,w(M.value,t=>(n(),s("option",{value:t.id,key:t.name},m(t.name),9,Qe))),128))],8,Je),[[g,S.value]])]),l("div",Xe,[e[26]||(e[26]=l("label",{class:"form-label"},"Helm chart",-1)),e[27]||(e[27]=l("p",{class:"text-muted"},"Select the application",-1)),p(l("select",{class:"form-select","onUpdate:modelValue":e[10]||(e[10]=t=>V.value=t),onChange:B},[(n(!0),s(b,null,w(_.value,(t,$)=>(n(),s("option",{key:$},m(t.name),1))),128))],544),[[g,V.value]])]),c.value=="Application Installation"?(n(),s("div",Ze,[e[34]||(e[34]=l("label",{class:"form-label"},"HPA",-1)),l("div",et,[l("div",null,[e[28]||(e[28]=l("label",{class:"form-label required"}," minReplicas ",-1)),p(l("input",{type:"number",class:"form-control w-90-per",placeholder:"1","onUpdate:modelValue":e[11]||(e[11]=t=>h.value.hpaMinReplicas=t)},null,512),[[U,h.value.hpaMinReplicas]])]),l("div",null,[e[29]||(e[29]=l("label",{class:"form-label required"}," maxReplicas ",-1)),p(l("input",{type:"number",class:"form-control w-90-per",placeholder:"10","onUpdate:modelValue":e[12]||(e[12]=t=>h.value.hpaMaxReplicas=t)},null,512),[[U,h.value.hpaMaxReplicas]])]),l("div",null,[e[30]||(e[30]=l("label",{class:"form-check-label mb-2"}," CPU (%) ",-1)),p(l("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"60","onUpdate:modelValue":e[13]||(e[13]=t=>h.value.hpaCpuUtilization=t)},null,512),[[U,h.value.hpaCpuUtilization]]),e[31]||(e[31]=j(" % "))]),l("div",null,[e[32]||(e[32]=l("label",{class:"form-check-label mb-2"}," MEMORY (%) ",-1)),p(l("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"80","onUpdate:modelValue":e[14]||(e[14]=t=>h.value.hpaMemoryUtilization=t)},null,512),[[U,h.value.hpaMemoryUtilization]]),e[33]||(e[33]=j(" % "))])])])):k("",!0)],64)):k("",!0)]),l("div",tt,[l("a",{class:"btn btn-link link-secondary","data-bs-dismiss":"modal",onClick:R}," Cancel "),l("div",null,[c.value=="Application Installation"?(n(),s("button",{key:0,class:"btn btn-danger ms-auto me-1",onClick:Q,disabled:!I.value}," Spec Check ",8,at)):k("",!0),l("button",{class:"btn btn-primary ms-auto","data-bs-dismiss":"modal",onClick:J,disabled:I.value}," RUN ",8,lt)])])])])]))}}),Vt=ne(st,[["__scopeId","data-v-cb30710c"]]);export{Vt as A,rt as I,ve as a,yt as b,ft as c,dt as d,It as e,kt as f,ht as g,bt as h,wt as i,re as j,mt as k,Ct as l,St as m,vt as n,pe as r,pt as s,gt as u};

import{c as le}from"./IconPlus-Bqy1Co_Y.js";import{d as te,u as se,c as ne,r as v,o as oe,a as s,b as l,t as f,j as b,e as r,v as y,F as k,f as S,g as C,y as H,l as j,h as n}from"./index-Dj9wJDrE.js";import{_ as ie}from"./lodash-CjzVU0-2.js";import{s as i}from"./request-D_V50x5y.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";/**
 * @license @tabler/icons-vue v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var wa=le("outline","search","IconSearch",[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]]);const re=()=>i.get("/cbtumblebug/ns"),ce=t=>i.get(`/cbtumblebug/ns/${t}/mci`),de=t=>i.get(`/cbtumblebug/ns/${t.nsId}/mci/${t.mciId}`),pe=t=>i.get(`/cbtumblebug/ns/${t}/k8scluster`),me=t=>i.get(`/catalog/software?name=${t}`),Sa=t=>i.get(`/catalog/software/${t}`),xa=t=>i.get(`/search/dockerhub/${t}`),Ua=t=>i.get(`/search/artifacthub/${t}`),ve=t=>i.post("/applications/vm/deploy",t),q=t=>i.post("/applications/action",t),be=t=>i.post("/applications/k8s/deploy",t),fe=t=>i.get(`/applications/vm/check?namespace=${t.namespace}&mciId=${t.mciName}&vmId=${t.vmName}&catalogId=${t.catalogId}`),ge=t=>i.get(`/applications/k8s/check?namespace=${t.namespace}&clusterName=${t.clusterName}&catalogId=${t.catalogId}`),Va=t=>i.get(`/ape/log/${t}`);function Aa(t){return i.post("/catalog/software",t)}function Ea(t){return i.put(`/catalog/software/${t.id}`,t)}function Ma(t){return i.delete(`/catalog/software/${t}`)}function Na(){return i.get("/api/applications/status/groups")}function Ta(t){return i.post("/catalog/application/category",t)}function La(t){return i.post("/catalog/application/package",t)}function _a(t){const g={target:t.target,applicationName:t.packageName};return i.post("/catalog/application/package/version",g)}function $a(t){return i.get(`/search/dockerhub/tag/${t.path}`)}function Pa(t){return i.get(`/search/artifacthub/version/${t.kind}/${t.repository}/${t.packageName}`)}function Ra(t){return i.post("/catalog/docker/register",t)}function Ha(t){return i.post("/catalog/helm/register",t)}function Fa(t){return i.post("/catalog/rating/overall",t)}function Da(t){return i.get(`/api/applications/integrated/deployment/${t}`)}function za(t){return i.get(`/catalog/selectbox/option?type=${t}`)}const he={class:"modal fade",id:"install-form",tabindex:"-1"},ye={class:"modal-dialog modal-lg",role:"document"},ke={class:"modal-content"},Ce={class:"modal-header"},Ie={class:"modal-title"},we={class:"modal-body",style:{"max-height":"calc(100vh - 200px)","overflow-y":"auto"}},Se={class:"mb-3"},xe={key:0,class:"text-muted"},Ue={key:1,class:"text-muted"},Ve=["value"],Ae={class:"mb-3"},Ee={key:0,class:"text-muted"},Me={key:1,class:"text-muted"},Ne=["value"],Te={value:"selectNsId"},Le={class:"mb-3"},_e={key:0,class:"text-muted"},$e={key:1,class:"text-muted"},Pe=["disabled"],Re=["value"],He={class:"mb-3"},Fe=["disabled"],De=["value"],ze={class:"mb-3"},Ke={class:"mb-3"},Be={class:"mb-3"},je={key:0,class:"text-muted"},qe={key:1,class:"text-muted"},Ye=["value"],Oe={value:"selectNsId"},We={class:"mb-3"},Ge={key:0,class:"text-muted"},Je={key:1,class:"text-muted"},Qe=["disabled"],Xe=["value"],Ze={class:"mb-3"},ea={key:0,class:"mb-3"},aa={class:"mb-2"},la={class:"form-check"},ta={key:0,class:"d-flex justify-content-between"},sa={key:1,class:"mb-3"},na={class:"mb-2"},oa={class:"form-check"},ia={key:0},ua={class:"mb-2"},ra={class:"mb-2"},ca={class:"mb-2"},da={class:"mb-2"},pa={class:"form-check"},ma={key:0,class:"mb-2"},va={class:"modal-footer d-flex justify-content-between"},ba=["disabled"],fa=["disabled"],ga=te({__name:"applicationInstallationForm",props:{nsId:{},title:{}},setup(t){const g=se(),Y=t,d=ne(()=>Y.title),F=v([]),x=v([]),E=v([]),$=v([]),N=v([]),p=v(""),u=v(""),h=v(""),I=v(""),m=v({}),c=v({}),T=v([]),U=v(""),V=v(""),L=v(""),w=v(!0);oe(async()=>{document.getElementById("install-form").addEventListener("show.bs.modal",async()=>{await P(),await O()})});const P=async()=>{p.value="VM",u.value="",h.value="",I.value="",m.value={hpaEnabled:!1,hpaMinReplicas:1,hpaMaxReplicas:10,hpaCpuUtilization:60,hpaMemoryUtilization:80},c.value={ingressEnabled:!1,ingressHost:"",ingressPath:"/",ingressClass:"nginx",ingressTlsEnabled:!1,ingressTlsSecret:""},W(),G(),await J()},O=async()=>{await me("").then(({data:o})=>{N.value=o})},W=()=>{F.value=[{key:"VM",value:"VM"},{key:"k8s",value:"K8S"}]},G=()=>{d.value==="Application Uninstallation"?w.value=!1:w.value=!0},J=async()=>{await re().then(async({data:o})=>{x.value=o,x.value.length>0&&(u.value=x.value[0].name),ie.isEmpty(u.value)||(p.value==="VM"?await D():p.value==="K8S"&&await K())})},D=async()=>{await ce(u.value).then(async({data:o})=>{E.value=o,E.value.length>0?(h.value=E.value[0].name,await z()):h.value=""})},z=async()=>{const o={nsId:u.value,mciId:h.value};await de(o).then(({data:e})=>{$.value=e.vm,E.value.length>0?I.value=$.value[0].name:I.value=""})},K=async()=>{await pe(u.value).then(({data:o})=>{T.value=o,T.value.length>0?U.value=T.value[0].name:U.value=""})},R=async()=>{await D(),_()},Q=async()=>{await z(),_()},X=async()=>{await K(),_()},_=()=>{d.value==="Application Installation"?w.value=!0:d.value==="Application Uninstallation"&&(w.value=!1)},Z=async()=>{let o={};if(p.value==="VM"){V.value.split(",").map(a=>a.toLowerCase().trim());let e={};d.value=="Application Installation"?(e={namespace:u.value,mciId:h.value,vmId:I.value,catalogId:A.value,servicePort:L.value,username:"",deploymentType:p.value},o=await ve(e)):o=await q(e),o.data?g.success("SUCCESS"):g.error("FAIL")}else if(p.value==="K8S"){V.value.split(",").map(a=>a.toLowerCase().trim());let e={namespace:u.value,clusterName:U.value,catalogId:A.value,servicePort:L.value,username:"",deploymentType:p.value,hpaEnabled:m.value.hpaEnabled,minReplicas:m.value.hpaMinReplicas,maxReplicas:m.value.hpaMaxReplicas,cpuThreshold:m.value.hpaCpuUtilization,memoryThreshold:m.value.hpaMemoryUtilization,ingressEnabled:c.value.ingressEnabled,ingressHost:c.value.ingressHost,ingressPath:c.value.ingressPath,ingressClass:c.value.ingressClass,ingressTlsEnabled:c.value.ingressTlsEnabled,ingressTlsSecret:c.value.ingressTlsSecret};d.value=="Application Installation"?o=await be(e):o=await q(e),o.data?g.success("SUCCESS"):g.error("FAIL")}},ee=async()=>{p.value==="VM"||p.value==="K8S"?ae().then(o=>{let e=!0;if(o===null){g.error("Please select all items");return}else if(o===!1){let a="";p.value==="VM"?a="VM":p.value==="K8S"&&(a="CLUSTER");const M="Your selected "+a+" has lower specifications than recommended. Would you like to continue with the installation?";e=confirm(M)}e&&(g.success("Please click RUN"),w.value=!1)}):g.error("Please Select Infra")},ae=async()=>{let o=!1;if(p.value==="VM"){if(u.value===""||h.value===""||I.value===""||A.value===0)return null;{const e={namespace:u.value,mciName:h.value,vmName:I.value,catalogId:A.value};await fe(e).then(({data:a})=>{o=a})}}else if(p.value==="K8S"){if(u.value===""||U.value===""||A.value===0){g.error("Please select all items");return}const e={namespace:u.value,clusterName:U.value,catalogId:A.value};await ge(e).then(({data:a})=>{o=a})}return o},A=v(0),B=()=>{d.value==="Application Installation"&&(w.value=!0),N.value.forEach(o=>{if(V.value===o.name){A.value=o.id;return}})};return(o,e)=>(n(),s("div",he,[l("div",ye,[l("div",ke,[l("div",Ce,[l("h5",Ie,f(d.value),1),l("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:P})]),l("div",we,[l("div",Se,[e[22]||(e[22]=l("label",{class:"form-label"},"Target Infra",-1)),d.value=="Application Installation"?(n(),s("p",xe," Select the Infra what is the Infra will be installed ")):d.value=="Application Uninstallation"?(n(),s("p",Ue," Select the Infra what is the Infra will be uninstalled ")):b("",!0),r(l("select",{class:"form-select",id:"infra","onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),onClick:_},[(n(!0),s(k,null,S(F.value,a=>(n(),s("option",{value:a.value,key:a.value},f(a.value),9,Ve))),128))],512),[[y,p.value]])]),p.value=="VM"?(n(),s(k,{key:0},[l("div",Ae,[e[23]||(e[23]=l("label",{class:"form-label"},"Namespace",-1)),d.value=="Application Installation"?(n(),s("p",Ee," Select the namespace where the application will be installed")):d.value=="Application Uninstallation"?(n(),s("p",Me," Select the namespace where the application will be uninstalled")):b("",!0),x.value.length>0?r((n(),s("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[1]||(e[1]=a=>u.value=a),onChange:R},[(n(!0),s(k,null,S(x.value,a=>(n(),s("option",{value:a.name,key:a.name},f(a.name),9,Ne))),128))],544)),[[y,u.value]]):r((n(),s("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[2]||(e[2]=a=>u.value=a),onChange:R},[l("option",Te,f(u.value),1)],544)),[[y,u.value]])]),l("div",Le,[e[24]||(e[24]=l("label",{class:"form-label"},"MCI Name",-1)),d.value=="Application Installation"?(n(),s("p",_e," Select the multi-cloud infrastructure information where the application will be deployed")):d.value=="Application Uninstallation"?(n(),s("p",$e," Remove the application and associated resources from the multi-cloud infrastructure")):b("",!0),r(l("select",{class:"form-select",id:"mci-name",disabled:u.value=="","onUpdate:modelValue":e[3]||(e[3]=a=>h.value=a),onChange:Q},[(n(!0),s(k,null,S(E.value,a=>(n(),s("option",{value:a.id,key:a.name},f(a.name),9,Re))),128))],40,Pe),[[y,h.value]])]),l("div",He,[e[25]||(e[25]=l("label",{class:"form-label"},"VM Name",-1)),e[26]||(e[26]=l("p",{class:"text-muted"}," Select the virtual machine (VM) within the chosen multi-cloud infrastructure where the application will be deployed",-1)),r(l("select",{class:"form-select",id:"mci-name",disabled:h.value=="","onUpdate:modelValue":e[4]||(e[4]=a=>I.value=a)},[(n(!0),s(k,null,S($.value,a=>(n(),s("option",{value:a.id,key:a.name},f(a.name),9,De))),128))],8,Fe),[[y,I.value]])]),l("div",ze,[e[27]||(e[27]=l("label",{class:"form-label"},"Application",-1)),e[28]||(e[28]=l("p",{class:"text-muted"},"Select the application",-1)),r(l("select",{class:"form-select","onUpdate:modelValue":e[5]||(e[5]=a=>V.value=a),onChange:B},[(n(!0),s(k,null,S(N.value,(a,M)=>(n(),s("option",{key:M},f(a.name),1))),128))],544),[[y,V.value]])]),l("div",Ke,[e[29]||(e[29]=l("label",{class:"form-label"},"Port",-1)),e[30]||(e[30]=l("p",{class:"text-muted"},"Please enter a port accessible from the outside",-1)),r(l("input",{type:"number",class:"form-control",placeholder:"8080","onUpdate:modelValue":e[6]||(e[6]=a=>L.value=a)},null,512),[[C,L.value]])])],64)):p.value=="K8S"?(n(),s(k,{key:1},[l("div",Be,[e[31]||(e[31]=l("label",{class:"form-label"},"Namespace",-1)),d.value=="Application Installation"?(n(),s("p",je,"Select the namespace where the application will be installed")):d.value=="Application Uninstallation"?(n(),s("p",qe,"Select the namespace where the application will be uninstalled")):b("",!0),x.value.length>0?r((n(),s("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[7]||(e[7]=a=>u.value=a),onChange:X},[(n(!0),s(k,null,S(x.value,a=>(n(),s("option",{value:a.name,key:a.name},f(a.name),9,Ye))),128))],544)),[[y,u.value]]):r((n(),s("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[8]||(e[8]=a=>u.value=a),onChange:R},[l("option",Oe,f(u.value),1)],544)),[[y,u.value]])]),l("div",We,[e[32]||(e[32]=l("label",{class:"form-label"},"ClusterName",-1)),d.value=="Application Installation"?(n(),s("p",Ge,"Select the name of the cluster where the application will be deployed")):d.value=="Application Uninstallation"?(n(),s("p",Je,"Remove the application and associated resources from the multi-cloud infrastructure")):b("",!0),r(l("select",{class:"form-select",id:"mci-name",disabled:u.value=="","onUpdate:modelValue":e[9]||(e[9]=a=>U.value=a)},[(n(!0),s(k,null,S(T.value,a=>(n(),s("option",{value:a.id,key:a.name},f(a.name),9,Xe))),128))],8,Qe),[[y,U.value]])]),l("div",Ze,[e[33]||(e[33]=l("label",{class:"form-label"},"Helm chart",-1)),e[34]||(e[34]=l("p",{class:"text-muted"},"Select the application",-1)),r(l("select",{class:"form-select","onUpdate:modelValue":e[10]||(e[10]=a=>V.value=a),onChange:B},[(n(!0),s(k,null,S(N.value,(a,M)=>(n(),s("option",{key:M},f(a.name),1))),128))],544),[[y,V.value]])]),d.value=="Application Installation"?(n(),s("div",ea,[e[42]||(e[42]=l("label",{class:"form-label"},"HPA Configuration",-1)),l("div",aa,[l("div",la,[r(l("input",{class:"form-check-input",type:"checkbox",id:"hpaEnabled","onUpdate:modelValue":e[11]||(e[11]=a=>m.value.hpaEnabled=a)},null,512),[[H,m.value.hpaEnabled]]),e[35]||(e[35]=l("label",{class:"form-check-label",for:"hpaEnabled"}," Enable HPA (Horizontal Pod Autoscaler) ",-1))])]),m.value.hpaEnabled?(n(),s("div",ta,[l("div",null,[e[36]||(e[36]=l("label",{class:"form-label required"}," minReplicas ",-1)),r(l("input",{type:"number",class:"form-control w-90-per",placeholder:"1","onUpdate:modelValue":e[12]||(e[12]=a=>m.value.hpaMinReplicas=a)},null,512),[[C,m.value.hpaMinReplicas]])]),l("div",null,[e[37]||(e[37]=l("label",{class:"form-label required"}," maxReplicas ",-1)),r(l("input",{type:"number",class:"form-control w-90-per",placeholder:"10","onUpdate:modelValue":e[13]||(e[13]=a=>m.value.hpaMaxReplicas=a)},null,512),[[C,m.value.hpaMaxReplicas]])]),l("div",null,[e[38]||(e[38]=l("label",{class:"form-check-label mb-2"}," CPU (%) ",-1)),r(l("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"60","onUpdate:modelValue":e[14]||(e[14]=a=>m.value.hpaCpuUtilization=a)},null,512),[[C,m.value.hpaCpuUtilization]]),e[39]||(e[39]=j(" % "))]),l("div",null,[e[40]||(e[40]=l("label",{class:"form-check-label mb-2"}," MEMORY (%) ",-1)),r(l("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"80","onUpdate:modelValue":e[15]||(e[15]=a=>m.value.hpaMemoryUtilization=a)},null,512),[[C,m.value.hpaMemoryUtilization]]),e[41]||(e[41]=j(" % "))])])):b("",!0)])):b("",!0),d.value=="Application Installation"?(n(),s("div",sa,[e[49]||(e[49]=l("label",{class:"form-label"},"Ingress Configuration",-1)),l("div",na,[l("div",oa,[r(l("input",{class:"form-check-input",type:"checkbox",id:"ingressEnabled","onUpdate:modelValue":e[16]||(e[16]=a=>c.value.ingressEnabled=a)},null,512),[[H,c.value.ingressEnabled]]),e[43]||(e[43]=l("label",{class:"form-check-label",for:"ingressEnabled"}," Enable Ingress ",-1))])]),c.value.ingressEnabled?(n(),s("div",ia,[l("div",ua,[e[44]||(e[44]=l("label",{class:"form-label"},"Host",-1)),r(l("input",{type:"text",class:"form-control",placeholder:"example.com","onUpdate:modelValue":e[17]||(e[17]=a=>c.value.ingressHost=a)},null,512),[[C,c.value.ingressHost]])]),l("div",ra,[e[45]||(e[45]=l("label",{class:"form-label"},"Path",-1)),r(l("input",{type:"text",class:"form-control",placeholder:"/","onUpdate:modelValue":e[18]||(e[18]=a=>c.value.ingressPath=a)},null,512),[[C,c.value.ingressPath]])]),l("div",ca,[e[46]||(e[46]=l("label",{class:"form-label"},"Ingress Class",-1)),r(l("input",{type:"text",class:"form-control",placeholder:"nginx","onUpdate:modelValue":e[19]||(e[19]=a=>c.value.ingressClass=a)},null,512),[[C,c.value.ingressClass]])]),l("div",da,[l("div",pa,[r(l("input",{class:"form-check-input",type:"checkbox",id:"ingressTlsEnabled","onUpdate:modelValue":e[20]||(e[20]=a=>c.value.ingressTlsEnabled=a)},null,512),[[H,c.value.ingressTlsEnabled]]),e[47]||(e[47]=l("label",{class:"form-check-label",for:"ingressTlsEnabled"}," Enable TLS ",-1))])]),c.value.ingressTlsEnabled?(n(),s("div",ma,[e[48]||(e[48]=l("label",{class:"form-label"},"TLS Secret Name",-1)),r(l("input",{type:"text",class:"form-control",placeholder:"tls-secret","onUpdate:modelValue":e[21]||(e[21]=a=>c.value.ingressTlsSecret=a)},null,512),[[C,c.value.ingressTlsSecret]])])):b("",!0)])):b("",!0)])):b("",!0)],64)):b("",!0)]),l("div",va,[l("a",{class:"btn btn-link link-secondary","data-bs-dismiss":"modal",onClick:P}," Cancel "),l("div",null,[d.value=="Application Installation"?(n(),s("button",{key:0,class:"btn btn-danger ms-auto me-1",onClick:ee,disabled:!w.value}," Spec Check ",8,ba)):b("",!0),l("button",{class:"btn btn-primary ms-auto","data-bs-dismiss":"modal",onClick:Z,disabled:w.value}," Deploy ",8,fa)])])])])]))}}),Ka=ue(ga,[["__scopeId","data-v-1129f692"]]);export{Ka as A,wa as I,Da as a,Na as b,Ta as c,Aa as d,Sa as e,La as f,za as g,_a as h,Ma as i,$a as j,Pa as k,me as l,xa as m,Ua as n,Ra as o,Ha as p,Va as q,q as r,Fa as s,Ea as u};

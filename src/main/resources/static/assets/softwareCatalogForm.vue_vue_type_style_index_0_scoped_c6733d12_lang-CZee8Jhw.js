import{c as de}from"./IconPlus-hVx77SyW.js";import{d as pe,u as me,c as ve,r as p,w as fe,o as be,a as s,b as a,t as b,j as h,e as r,v as S,F as y,f as x,x as J,g as U,y as j,l as q,h as n}from"./index-BI-N4_1B.js";import{_ as Q}from"./lodash-Ci81Wzut.js";import{s as i}from"./request-DO4hPR1r.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";/**
 * @license @tabler/icons-vue v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Fl=de("outline","search","IconSearch",[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]]);const he=()=>i.get("/cbtumblebug/ns"),ye=t=>i.get(`/cbtumblebug/ns/${t}/mci`),ke=t=>i.get(`/cbtumblebug/ns/${t.nsId}/mci/${t.mciId}`),Ce=t=>i.get(`/cbtumblebug/ns/${t}/k8scluster`),Ie=t=>i.get(`/catalog/software?name=${t}`),zl=t=>i.get(`/catalog/software/${t}`),Kl=t=>i.get(`/search/dockerhub/${t}`),Bl=t=>i.get(`/search/artifacthub/${t}`),we=t=>i.post("/applications/vm/deploy",t),Z=t=>i.post("/applications/action",t),Se=t=>i.post("/applications/k8s/deploy",t),Ve=t=>i.get(`/applications/vm/check?namespace=${t.namespace}&mciId=${t.mciName}&vmId=${t.vmName}&catalogId=${t.catalogId}`),xe=t=>i.get(`/applications/k8s/check?namespace=${t.namespace}&clusterName=${t.clusterName}&catalogId=${t.catalogId}`),jl=t=>i.get(`/ape/log/${t}`);function ql(t){return i.post("/catalog/software",t)}function Yl(t){return i.put(`/catalog/software/${t.id}`,t)}function Ol(t){return i.delete(`/catalog/software/${t}`)}function Wl(){return i.get("/api/applications/status/groups")}function Xl(t){return i.post("/catalog/application/category",t)}function Gl(t){return i.post("/catalog/application/package",t)}function Jl(t){const k={target:t.target,applicationName:t.packageName};return i.post("/catalog/application/package/version",k)}function Ql(t){return i.get(`/search/dockerhub/tag/${t.path}`)}function Zl(t){return i.get(`/search/artifacthub/version/${t.kind}/${t.repository}/${t.packageName}`)}function ea(t){return i.post("/catalog/docker/register",t)}function la(t){return i.post("/catalog/helm/register",t)}function aa(t){return i.post("/catalog/rating/overall",t)}function ta(t){return i.get(`/api/applications/integrated/deployment/${t}`)}function sa(t){return i.get(`/catalog/selectbox/options?type=${t}`)}const Ue={class:"modal fade",id:"install-form",tabindex:"-1"},Me={class:"modal-dialog modal-lg",role:"document"},Ae={class:"modal-content"},Ee={class:"modal-header"},Ne={class:"modal-title"},Te={class:"modal-body",style:{"max-height":"calc(100vh - 200px)","overflow-y":"auto"}},Le={class:"mb-3"},$e={key:0,class:"text-muted"},_e={key:1,class:"text-muted"},Pe=["value"],Re={class:"mb-3"},He={key:0,class:"text-muted"},De={key:1,class:"text-muted"},Fe=["value"],ze={value:"selectNsId"},Ke={class:"mb-3"},Be={key:0,class:"text-muted"},je={key:1,class:"text-muted"},qe=["disabled"],Ye=["value"],Oe={class:"mb-3"},We=["disabled"],Xe=["value"],Ge={key:0,class:"mt-2",style:{display:"flex",gap:"10px","flex-wrap":"wrap"}},Je=["onClick"],Qe={class:"mb-3"},Ze={style:{display:"flex",gap:"10px"}},el={class:"form-check"},ll={class:"form-check"},al={class:"mb-3"},tl=["value"],sl={class:"mb-3"},nl={class:"mb-3"},ol={key:0,class:"text-muted"},il={key:1,class:"text-muted"},ul=["value"],rl={value:"selectNsId"},cl={class:"mb-3"},dl={key:0,class:"text-muted"},pl={key:1,class:"text-muted"},ml=["disabled"],vl=["value"],fl={class:"mb-3"},bl=["value"],gl={key:0,class:"mb-3"},hl={class:"mb-2"},yl={class:"form-check"},kl={key:0,class:"d-flex justify-content-between"},Cl={key:1,class:"mb-3"},Il={class:"mb-2"},wl={class:"form-check"},Sl={key:0},Vl={class:"mb-2"},xl={class:"mb-2"},Ul={class:"mb-2"},Ml={class:"mb-2"},Al={class:"form-check"},El={key:0,class:"mb-2"},Nl={class:"modal-footer d-flex justify-content-between"},Tl=["disabled"],Ll=["disabled"],$l=pe({__name:"applicationInstallationForm",props:{nsId:{},title:{}},setup(t){const k=me(),z=t,d=ve(()=>z.title),Y=p([]),A=p([]),R=p([]),E=p([]),L=p([]),H=p([]),m=p(""),u=p(""),C=p(""),I=p(""),f=p([]),g=p("Standalone"),v=p({}),c=p({}),D=p([]),N=p(""),V=p(""),F=p(""),M=p(!0);fe(g,()=>{g.value==="Standalone"?(f.value=[],E.value=[...L.value]):g.value==="Clustering"&&(f.value=[],E.value=[...L.value])}),be(async()=>{document.getElementById("install-form").addEventListener("show.bs.modal",async()=>{await K(),await ee()})});const K=async()=>{m.value="VM",u.value="",C.value="",I.value="",f.value=[],L.value=[],g.value="Standalone",v.value={hpaEnabled:!1,hpaMinReplicas:1,hpaMaxReplicas:10,hpaCpuUtilization:60,hpaMemoryUtilization:80},c.value={ingressEnabled:!1,ingressHost:"",ingressPath:"/",ingressClass:"nginx",ingressTlsEnabled:!1,ingressTlsSecret:""},le(),ae(),await te()},ee=async()=>{await Ie("").then(({data:o})=>{H.value=o})},le=()=>{Y.value=[{key:"VM",value:"VM"},{key:"k8s",value:"K8S"}]},ae=()=>{d.value==="Application Uninstallation"?M.value=!1:M.value=!0},te=async()=>{await he().then(async({data:o})=>{console.log("## data ### : ",o),A.value=o,A.value.length>0&&(Q.isEmpty(z.nsId)?u.value=A.value[1].name:u.value=z.nsId),Q.isEmpty(u.value)||(m.value==="VM"?await O():m.value==="K8S"&&await X())})},O=async()=>{await ye(u.value).then(async({data:o})=>{R.value=o,R.value.length>0?(C.value=R.value[0].name,await W()):C.value=""})},W=async()=>{const o={nsId:u.value,mciId:C.value};await ke(o).then(({data:e})=>{L.value=e.vm,E.value=L.value.filter(l=>!f.value.includes(l.id)),I.value=""})},X=async()=>{await Ce(u.value).then(({data:o})=>{D.value=o,D.value.length>0?N.value=D.value[0].name:N.value=""})},B=async()=>{f.value=[],await O(),$()},se=async()=>{f.value=[],await W(),$()},ne=async()=>{await X(),$()},$=()=>{d.value==="Application Installation"?M.value=!0:d.value==="Application Uninstallation"&&(M.value=!1)},oe=()=>{if(I.value!==""){if(g.value==="Standalone")f.value=[I.value];else if(g.value==="Clustering"&&!f.value.includes(I.value)){f.value.push(I.value);const o=E.value.findIndex(e=>e.id===I.value);o!==-1&&E.value.splice(o,1)}I.value="",$()}},ie=o=>{const e=f.value[o];if(f.value.splice(o,1),g.value==="Clustering"){const l=L.value.find(w=>w.id===e);l&&E.value.push(l)}$()},ue=async()=>{let o={};if(m.value==="VM"){V.value.split(",").map(l=>l.toLowerCase().trim());let e={};if(d.value=="Application Installation"){const l=g.value==="Clustering"?`${V.value}-cluster`:`${V.value}-standalone`;e={namespace:u.value,mciId:C.value,vmIds:f.value,clusterName:l,catalogId:T.value,servicePort:F.value,username:"admin",deploymentType:m.value,vmDeploymentMode:g.value.toUpperCase()},o=await we(e)}else o=await Z(e);o.data?k.success("SUCCESS"):k.error("FAIL")}else if(m.value==="K8S"){V.value.split(",").map(l=>l.toLowerCase().trim());let e={namespace:u.value,clusterName:N.value,catalogId:T.value,servicePort:F.value,username:"",deploymentType:m.value,hpaEnabled:v.value.hpaEnabled,minReplicas:v.value.hpaMinReplicas,maxReplicas:v.value.hpaMaxReplicas,cpuThreshold:v.value.hpaCpuUtilization,memoryThreshold:v.value.hpaMemoryUtilization,ingressEnabled:c.value.ingressEnabled,ingressHost:c.value.ingressHost,ingressPath:c.value.ingressPath,ingressClass:c.value.ingressClass,ingressTlsEnabled:c.value.ingressTlsEnabled,ingressTlsSecret:c.value.ingressTlsSecret};d.value=="Application Installation"?o=await Se(e):o=await Z(e),o.data?k.success("SUCCESS"):k.error("FAIL")}},re=async()=>{m.value==="VM"||m.value==="K8S"?ce().then(o=>{let e=!0;if(o===null){k.error("Please select all items");return}else if(o===!1){let l="";m.value==="VM"?l="VM":m.value==="K8S"&&(l="CLUSTER");const w="Your selected "+l+" has lower specifications than recommended. Would you like to continue with the installation?";e=confirm(w)}e&&(k.success("Please click RUN"),M.value=!1)}):k.error("Please Select Infra")},ce=async()=>{let o=!1;if(m.value==="VM"){if(u.value===""||C.value===""||f.value.length===0||T.value===0)return null;{const e={namespace:u.value,mciName:C.value,vmName:f.value[0],catalogId:T.value};await Ve(e).then(({data:l})=>{o=l})}}else if(m.value==="K8S"){if(u.value===""||N.value===""||T.value===0){k.error("Please select all items");return}const e={namespace:u.value,clusterName:N.value,catalogId:T.value};await xe(e).then(({data:l})=>{o=l})}return o},T=p(0),G=()=>{d.value==="Application Installation"&&(M.value=!0),H.value.forEach(o=>{if(V.value===o.name){T.value=o.id;return}})};return(o,e)=>(n(),s("div",Ue,[a("div",Me,[a("div",Ae,[a("div",Ee,[a("h5",Ne,b(d.value),1),a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:K})]),a("div",Te,[a("div",Le,[e[24]||(e[24]=a("label",{class:"form-label"},"Target Infra",-1)),d.value=="Application Installation"?(n(),s("p",$e," Select the Infra what is the Infra will be installed ")):d.value=="Application Uninstallation"?(n(),s("p",_e," Select the Infra what is the Infra will be uninstalled ")):h("",!0),r(a("select",{class:"form-select",id:"infra","onUpdate:modelValue":e[0]||(e[0]=l=>m.value=l),onClick:$},[(n(!0),s(y,null,x(Y.value,l=>(n(),s("option",{value:l.value,key:l.value},b(l.value),9,Pe))),128))],512),[[S,m.value]])]),m.value=="VM"?(n(),s(y,{key:0},[a("div",Re,[e[25]||(e[25]=a("label",{class:"form-label"},"Namespace",-1)),d.value=="Application Installation"?(n(),s("p",He," Select the namespace where the application will be installed")):d.value=="Application Uninstallation"?(n(),s("p",De," Select the namespace where the application will be uninstalled")):h("",!0),A.value.length>0?r((n(),s("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[1]||(e[1]=l=>u.value=l),onChange:B},[(n(!0),s(y,null,x(A.value,l=>(n(),s("option",{value:l.name,key:l.name},b(l.name),9,Fe))),128))],544)),[[S,u.value]]):r((n(),s("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[2]||(e[2]=l=>u.value=l),onChange:B},[a("option",ze,b(u.value),1)],544)),[[S,u.value]])]),a("div",Ke,[e[26]||(e[26]=a("label",{class:"form-label"},"MCI Name",-1)),d.value=="Application Installation"?(n(),s("p",Be," Select the multi-cloud infrastructure information where the application will be deployed")):d.value=="Application Uninstallation"?(n(),s("p",je," Remove the application and associated resources from the multi-cloud infrastructure")):h("",!0),r(a("select",{class:"form-select",id:"mci-name",disabled:u.value=="","onUpdate:modelValue":e[3]||(e[3]=l=>C.value=l),onChange:se},[(n(!0),s(y,null,x(R.value,l=>(n(),s("option",{value:l.id,key:l.name},b(l.name),9,Ye))),128))],40,qe),[[S,C.value]])]),a("div",Oe,[e[28]||(e[28]=a("label",{class:"form-label"},"VM Name",-1)),e[29]||(e[29]=a("p",{class:"text-muted"}," Select the virtual machine (VM) within the chosen multi-cloud infrastructure where the application will be deployed",-1)),r(a("select",{class:"form-select",id:"mci-name",disabled:C.value=="","onUpdate:modelValue":e[4]||(e[4]=l=>I.value=l),onChange:oe},[e[27]||(e[27]=a("option",{value:""},"Select VM",-1)),(n(!0),s(y,null,x(E.value,l=>(n(),s("option",{value:l.id,key:l.name},b(l.name),9,Xe))),128))],40,We),[[S,I.value]]),f.value.length>0?(n(),s("div",Ge,[(n(!0),s(y,null,x(f.value,(l,w)=>(n(),s("label",{key:w,class:"form-check-label",style:{border:"1px solid #000",padding:"5px","border-radius":"5px",cursor:"pointer"}},[q(b(l)+" ",1),a("span",{onClick:_=>ie(w),style:{"margin-left":"5px","font-weight":"bold"}},"X",8,Je)]))),128))])):h("",!0)]),a("div",Qe,[e[32]||(e[32]=a("label",{class:"form-label"},"Deployment Type",-1)),e[33]||(e[33]=a("p",{class:"text-muted"},"Select the deployment type",-1)),a("div",Ze,[a("div",el,[r(a("input",{class:"form-check-input",type:"radio",id:"Standalone","onUpdate:modelValue":e[5]||(e[5]=l=>g.value=l),value:"Standalone"},null,512),[[J,g.value]]),e[30]||(e[30]=a("label",{class:"form-check-label",for:"Standalone"},"Standalone",-1))]),a("div",ll,[r(a("input",{class:"form-check-input",type:"radio",id:"Clustering","onUpdate:modelValue":e[6]||(e[6]=l=>g.value=l),value:"Clustering"},null,512),[[J,g.value]]),e[31]||(e[31]=a("label",{class:"form-check-label",for:"Clustering"},"Clustering",-1))])])]),a("div",al,[e[34]||(e[34]=a("label",{class:"form-label"},"Application",-1)),e[35]||(e[35]=a("p",{class:"text-muted"},"Select the application",-1)),r(a("select",{class:"form-select","onUpdate:modelValue":e[7]||(e[7]=l=>V.value=l),onChange:G},[(n(!0),s(y,null,x(H.value,(l,w)=>{var _,P;return n(),s("option",{key:w,value:l.name}," ["+b(l.name)+"] "+b((_=l.packageInfo)!=null&&_.packageVersion?(P=l.packageInfo)==null?void 0:P.packageVersion:"latest"),9,tl)}),128))],544),[[S,V.value]])]),a("div",sl,[e[36]||(e[36]=a("label",{class:"form-label"},"Port",-1)),e[37]||(e[37]=a("p",{class:"text-muted"},"Please enter a port accessible from the outside",-1)),r(a("input",{type:"number",class:"form-control",placeholder:"8080","onUpdate:modelValue":e[8]||(e[8]=l=>F.value=l)},null,512),[[U,F.value]])])],64)):m.value=="K8S"?(n(),s(y,{key:1},[a("div",nl,[e[38]||(e[38]=a("label",{class:"form-label"},"Namespace",-1)),d.value=="Application Installation"?(n(),s("p",ol,"Select the namespace where the application will be installed")):d.value=="Application Uninstallation"?(n(),s("p",il,"Select the namespace where the application will be uninstalled")):h("",!0),A.value.length>0?r((n(),s("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[9]||(e[9]=l=>u.value=l),onChange:ne},[(n(!0),s(y,null,x(A.value,l=>(n(),s("option",{value:l.name,key:l.name},b(l.name),9,ul))),128))],544)),[[S,u.value]]):r((n(),s("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[10]||(e[10]=l=>u.value=l),onChange:B},[a("option",rl,b(u.value),1)],544)),[[S,u.value]])]),a("div",cl,[e[39]||(e[39]=a("label",{class:"form-label"},"ClusterName",-1)),d.value=="Application Installation"?(n(),s("p",dl,"Select the name of the cluster where the application will be deployed")):d.value=="Application Uninstallation"?(n(),s("p",pl,"Remove the application and associated resources from the multi-cloud infrastructure")):h("",!0),r(a("select",{class:"form-select",id:"mci-name",disabled:u.value=="","onUpdate:modelValue":e[11]||(e[11]=l=>N.value=l)},[(n(!0),s(y,null,x(D.value,l=>(n(),s("option",{value:l.id,key:l.name},b(l.name),9,vl))),128))],8,ml),[[S,N.value]])]),a("div",fl,[e[40]||(e[40]=a("label",{class:"form-label"},"Helm chart",-1)),e[41]||(e[41]=a("p",{class:"text-muted"},"Select the application",-1)),r(a("select",{class:"form-select","onUpdate:modelValue":e[12]||(e[12]=l=>V.value=l),onChange:G},[(n(!0),s(y,null,x(H.value,(l,w)=>{var _,P;return n(),s("option",{key:w,value:l.name},b(l.name)+" / "+b((_=l.helmChart)!=null&&_.chartVersion?(P=l.helmChart)==null?void 0:P.chartVersion:"latest"),9,bl)}),128))],544),[[S,V.value]])]),d.value=="Application Installation"?(n(),s("div",gl,[e[49]||(e[49]=a("label",{class:"form-label"},"HPA Configuration",-1)),a("div",hl,[a("div",yl,[r(a("input",{class:"form-check-input",type:"checkbox",id:"hpaEnabled","onUpdate:modelValue":e[13]||(e[13]=l=>v.value.hpaEnabled=l)},null,512),[[j,v.value.hpaEnabled]]),e[42]||(e[42]=a("label",{class:"form-check-label",for:"hpaEnabled"}," Enable HPA (Horizontal Pod Autoscaler) ",-1))])]),v.value.hpaEnabled?(n(),s("div",kl,[a("div",null,[e[43]||(e[43]=a("label",{class:"form-label required"}," minReplicas ",-1)),r(a("input",{type:"number",class:"form-control w-90-per",placeholder:"1","onUpdate:modelValue":e[14]||(e[14]=l=>v.value.hpaMinReplicas=l)},null,512),[[U,v.value.hpaMinReplicas]])]),a("div",null,[e[44]||(e[44]=a("label",{class:"form-label required"}," maxReplicas ",-1)),r(a("input",{type:"number",class:"form-control w-90-per",placeholder:"10","onUpdate:modelValue":e[15]||(e[15]=l=>v.value.hpaMaxReplicas=l)},null,512),[[U,v.value.hpaMaxReplicas]])]),a("div",null,[e[45]||(e[45]=a("label",{class:"form-check-label mb-2"}," CPU (%) ",-1)),r(a("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"60","onUpdate:modelValue":e[16]||(e[16]=l=>v.value.hpaCpuUtilization=l)},null,512),[[U,v.value.hpaCpuUtilization]]),e[46]||(e[46]=q(" % "))]),a("div",null,[e[47]||(e[47]=a("label",{class:"form-check-label mb-2"}," MEMORY (%) ",-1)),r(a("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"80","onUpdate:modelValue":e[17]||(e[17]=l=>v.value.hpaMemoryUtilization=l)},null,512),[[U,v.value.hpaMemoryUtilization]]),e[48]||(e[48]=q(" % "))])])):h("",!0)])):h("",!0),d.value=="Application Installation"?(n(),s("div",Cl,[e[56]||(e[56]=a("label",{class:"form-label"},"Ingress Configuration",-1)),a("div",Il,[a("div",wl,[r(a("input",{class:"form-check-input",type:"checkbox",id:"ingressEnabled","onUpdate:modelValue":e[18]||(e[18]=l=>c.value.ingressEnabled=l)},null,512),[[j,c.value.ingressEnabled]]),e[50]||(e[50]=a("label",{class:"form-check-label",for:"ingressEnabled"}," Enable Ingress ",-1))])]),c.value.ingressEnabled?(n(),s("div",Sl,[a("div",Vl,[e[51]||(e[51]=a("label",{class:"form-label"},"Host",-1)),r(a("input",{type:"text",class:"form-control",placeholder:"example.com","onUpdate:modelValue":e[19]||(e[19]=l=>c.value.ingressHost=l)},null,512),[[U,c.value.ingressHost]])]),a("div",xl,[e[52]||(e[52]=a("label",{class:"form-label"},"Path",-1)),r(a("input",{type:"text",class:"form-control",placeholder:"/","onUpdate:modelValue":e[20]||(e[20]=l=>c.value.ingressPath=l)},null,512),[[U,c.value.ingressPath]])]),a("div",Ul,[e[53]||(e[53]=a("label",{class:"form-label"},"Ingress Class",-1)),r(a("input",{type:"text",class:"form-control",placeholder:"nginx","onUpdate:modelValue":e[21]||(e[21]=l=>c.value.ingressClass=l)},null,512),[[U,c.value.ingressClass]])]),a("div",Ml,[a("div",Al,[r(a("input",{class:"form-check-input",type:"checkbox",id:"ingressTlsEnabled","onUpdate:modelValue":e[22]||(e[22]=l=>c.value.ingressTlsEnabled=l)},null,512),[[j,c.value.ingressTlsEnabled]]),e[54]||(e[54]=a("label",{class:"form-check-label",for:"ingressTlsEnabled"}," Enable TLS ",-1))])]),c.value.ingressTlsEnabled?(n(),s("div",El,[e[55]||(e[55]=a("label",{class:"form-label"},"TLS Secret Name",-1)),r(a("input",{type:"text",class:"form-control",placeholder:"tls-secret","onUpdate:modelValue":e[23]||(e[23]=l=>c.value.ingressTlsSecret=l)},null,512),[[U,c.value.ingressTlsSecret]])])):h("",!0)])):h("",!0)])):h("",!0)],64)):h("",!0)]),a("div",Nl,[a("a",{class:"btn btn-link link-secondary","data-bs-dismiss":"modal",onClick:K}," Cancel "),a("div",null,[d.value=="Application Installation"?(n(),s("button",{key:0,class:"btn btn-danger ms-auto me-1",onClick:re,disabled:!M.value}," Spec Check ",8,Tl)):h("",!0),a("button",{class:"btn btn-primary ms-auto","data-bs-dismiss":"modal",onClick:ue,disabled:M.value}," Deploy ",8,Ll)])])])])]))}}),na=ge($l,[["__scopeId","data-v-7261f4b1"]]);export{na as A,Fl as I,ta as a,Wl as b,Xl as c,ql as d,zl as e,Gl as f,sa as g,Jl as h,Ol as i,Ql as j,Zl as k,Ie as l,Kl as m,Bl as n,ea as o,la as p,jl as q,Z as r,aa as s,Yl as u};

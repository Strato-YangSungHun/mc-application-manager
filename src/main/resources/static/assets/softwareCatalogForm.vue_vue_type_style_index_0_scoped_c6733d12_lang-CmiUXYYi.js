import{c as se}from"./IconPlus-BabRN9zD.js";import{d as ne,u as oe,c as ie,r as v,o as ue,a as s,b as l,t as b,j as f,e as r,v as y,F as k,f as S,g as C,y as D,l as Y,h as n}from"./index-YnsVGPR9.js";import{_ as re}from"./lodash-D2f7nRt3.js";import{s as i}from"./request-CCztSU4Q.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";/**
 * @license @tabler/icons-vue v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ua=se("outline","search","IconSearch",[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]]);const de=()=>i.get("/cbtumblebug/ns"),pe=t=>i.get(`/cbtumblebug/ns/${t}/mci`),me=t=>i.get(`/cbtumblebug/ns/${t.nsId}/mci/${t.mciId}`),ve=t=>i.get(`/cbtumblebug/ns/${t}/k8scluster`),be=t=>i.get(`/catalog/software?name=${t}`),Aa=t=>i.get(`/catalog/software/${t}`),Ea=t=>i.get(`/search/dockerhub/${t}`),Ma=t=>i.get(`/search/artifacthub/${t}`),fe=t=>i.post("/applications/vm/deploy",t),O=t=>i.post("/applications/action",t),ge=t=>i.post("/applications/k8s/deploy",t),he=t=>i.get(`/applications/vm/check?namespace=${t.namespace}&mciId=${t.mciName}&vmId=${t.vmName}&catalogId=${t.catalogId}`),ye=t=>i.get(`/applications/k8s/check?namespace=${t.namespace}&clusterName=${t.clusterName}&catalogId=${t.catalogId}`),Na=t=>i.get(`/ape/log/${t}`);function _a(t){return i.post("/catalog/software",t)}function Ta(t){return i.put(`/catalog/software/${t.id}`,t)}function La(t){return i.delete(`/catalog/software/${t}`)}function $a(){return i.get("/api/applications/status/groups")}function Pa(t){return i.post("/catalog/application/category",t)}function Ra(t){return i.post("/catalog/application/package",t)}function Ha(t){const g={target:t.target,applicationName:t.packageName};return i.post("/catalog/application/package/version",g)}function Fa(t){return i.get(`/search/dockerhub/tag/${t.path}`)}function Da(t){return i.get(`/search/artifacthub/version/${t.kind}/${t.repository}/${t.packageName}`)}function za(t){return i.post("/catalog/docker/register",t)}function Ka(t){return i.post("/catalog/helm/register",t)}function Ba(t){return i.post("/catalog/rating/overall",t)}function ja(t){return i.get(`/api/applications/integrated/deployment/${t}`)}function qa(t){return i.get(`/catalog/selectbox/options?type=${t}`)}const ke={class:"modal fade",id:"install-form",tabindex:"-1"},Ce={class:"modal-dialog modal-lg",role:"document"},Ie={class:"modal-content"},we={class:"modal-header"},Se={class:"modal-title"},Ve={class:"modal-body",style:{"max-height":"calc(100vh - 200px)","overflow-y":"auto"}},xe={class:"mb-3"},Ue={key:0,class:"text-muted"},Ae={key:1,class:"text-muted"},Ee=["value"],Me={class:"mb-3"},Ne={key:0,class:"text-muted"},_e={key:1,class:"text-muted"},Te=["value"],Le={value:"selectNsId"},$e={class:"mb-3"},Pe={key:0,class:"text-muted"},Re={key:1,class:"text-muted"},He=["disabled"],Fe=["value"],De={class:"mb-3"},ze=["disabled"],Ke=["value"],Be={class:"mb-3"},je=["value"],qe={class:"mb-3"},Ye={class:"mb-3"},Oe={key:0,class:"text-muted"},We={key:1,class:"text-muted"},Ge=["value"],Je={value:"selectNsId"},Qe={class:"mb-3"},Xe={key:0,class:"text-muted"},Ze={key:1,class:"text-muted"},ea=["disabled"],aa=["value"],la={class:"mb-3"},ta=["value"],sa={key:0,class:"mb-3"},na={class:"mb-2"},oa={class:"form-check"},ia={key:0,class:"d-flex justify-content-between"},ua={key:1,class:"mb-3"},ra={class:"mb-2"},ca={class:"form-check"},da={key:0},pa={class:"mb-2"},ma={class:"mb-2"},va={class:"mb-2"},ba={class:"mb-2"},fa={class:"form-check"},ga={key:0,class:"mb-2"},ha={class:"modal-footer d-flex justify-content-between"},ya=["disabled"],ka=["disabled"],Ca=ne({__name:"applicationInstallationForm",props:{nsId:{},title:{}},setup(t){const g=oe(),W=t,d=ie(()=>W.title),z=v([]),V=v([]),E=v([]),R=v([]),T=v([]),p=v(""),u=v(""),h=v(""),I=v(""),m=v({}),c=v({}),L=v([]),x=v(""),U=v(""),$=v(""),w=v(!0);ue(async()=>{document.getElementById("install-form").addEventListener("show.bs.modal",async()=>{await H(),await G()})});const H=async()=>{p.value="VM",u.value="",h.value="",I.value="",m.value={hpaEnabled:!1,hpaMinReplicas:1,hpaMaxReplicas:10,hpaCpuUtilization:60,hpaMemoryUtilization:80},c.value={ingressEnabled:!1,ingressHost:"",ingressPath:"/",ingressClass:"nginx",ingressTlsEnabled:!1,ingressTlsSecret:""},J(),Q(),await X()},G=async()=>{await be("").then(({data:o})=>{T.value=o})},J=()=>{z.value=[{key:"VM",value:"VM"},{key:"k8s",value:"K8S"}]},Q=()=>{d.value==="Application Uninstallation"?w.value=!1:w.value=!0},X=async()=>{await de().then(async({data:o})=>{V.value=o,V.value.length>0&&(u.value=V.value[0].name),re.isEmpty(u.value)||(p.value==="VM"?await K():p.value==="K8S"&&await j())})},K=async()=>{await pe(u.value).then(async({data:o})=>{E.value=o,E.value.length>0?(h.value=E.value[0].name,await B()):h.value=""})},B=async()=>{const o={nsId:u.value,mciId:h.value};await me(o).then(({data:e})=>{R.value=e.vm,E.value.length>0?I.value=R.value[0].name:I.value=""})},j=async()=>{await ve(u.value).then(({data:o})=>{L.value=o,L.value.length>0?x.value=L.value[0].name:x.value=""})},F=async()=>{await K(),P()},Z=async()=>{await B(),P()},ee=async()=>{await j(),P()},P=()=>{d.value==="Application Installation"?w.value=!0:d.value==="Application Uninstallation"&&(w.value=!1)},ae=async()=>{let o={};if(p.value==="VM"){U.value.split(",").map(a=>a.toLowerCase().trim());let e={};d.value=="Application Installation"?(e={namespace:u.value,mciId:h.value,vmId:I.value,catalogId:A.value,servicePort:$.value,username:"",deploymentType:p.value},o=await fe(e)):o=await O(e),o.data?g.success("SUCCESS"):g.error("FAIL")}else if(p.value==="K8S"){U.value.split(",").map(a=>a.toLowerCase().trim());let e={namespace:u.value,clusterName:x.value,catalogId:A.value,servicePort:$.value,username:"",deploymentType:p.value,hpaEnabled:m.value.hpaEnabled,minReplicas:m.value.hpaMinReplicas,maxReplicas:m.value.hpaMaxReplicas,cpuThreshold:m.value.hpaCpuUtilization,memoryThreshold:m.value.hpaMemoryUtilization,ingressEnabled:c.value.ingressEnabled,ingressHost:c.value.ingressHost,ingressPath:c.value.ingressPath,ingressClass:c.value.ingressClass,ingressTlsEnabled:c.value.ingressTlsEnabled,ingressTlsSecret:c.value.ingressTlsSecret};d.value=="Application Installation"?o=await ge(e):o=await O(e),o.data?g.success("SUCCESS"):g.error("FAIL")}},le=async()=>{p.value==="VM"||p.value==="K8S"?te().then(o=>{let e=!0;if(o===null){g.error("Please select all items");return}else if(o===!1){let a="";p.value==="VM"?a="VM":p.value==="K8S"&&(a="CLUSTER");const M="Your selected "+a+" has lower specifications than recommended. Would you like to continue with the installation?";e=confirm(M)}e&&(g.success("Please click RUN"),w.value=!1)}):g.error("Please Select Infra")},te=async()=>{let o=!1;if(p.value==="VM"){if(u.value===""||h.value===""||I.value===""||A.value===0)return null;{const e={namespace:u.value,mciName:h.value,vmName:I.value,catalogId:A.value};await he(e).then(({data:a})=>{o=a})}}else if(p.value==="K8S"){if(u.value===""||x.value===""||A.value===0){g.error("Please select all items");return}const e={namespace:u.value,clusterName:x.value,catalogId:A.value};await ye(e).then(({data:a})=>{o=a})}return o},A=v(0),q=()=>{d.value==="Application Installation"&&(w.value=!0),T.value.forEach(o=>{if(U.value===o.name){A.value=o.id;return}})};return(o,e)=>(n(),s("div",ke,[l("div",Ce,[l("div",Ie,[l("div",we,[l("h5",Se,b(d.value),1),l("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:H})]),l("div",Ve,[l("div",xe,[e[22]||(e[22]=l("label",{class:"form-label"},"Target Infra",-1)),d.value=="Application Installation"?(n(),s("p",Ue," Select the Infra what is the Infra will be installed ")):d.value=="Application Uninstallation"?(n(),s("p",Ae," Select the Infra what is the Infra will be uninstalled ")):f("",!0),r(l("select",{class:"form-select",id:"infra","onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),onClick:P},[(n(!0),s(k,null,S(z.value,a=>(n(),s("option",{value:a.value,key:a.value},b(a.value),9,Ee))),128))],512),[[y,p.value]])]),p.value=="VM"?(n(),s(k,{key:0},[l("div",Me,[e[23]||(e[23]=l("label",{class:"form-label"},"Namespace",-1)),d.value=="Application Installation"?(n(),s("p",Ne," Select the namespace where the application will be installed")):d.value=="Application Uninstallation"?(n(),s("p",_e," Select the namespace where the application will be uninstalled")):f("",!0),V.value.length>0?r((n(),s("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[1]||(e[1]=a=>u.value=a),onChange:F},[(n(!0),s(k,null,S(V.value,a=>(n(),s("option",{value:a.name,key:a.name},b(a.name),9,Te))),128))],544)),[[y,u.value]]):r((n(),s("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[2]||(e[2]=a=>u.value=a),onChange:F},[l("option",Le,b(u.value),1)],544)),[[y,u.value]])]),l("div",$e,[e[24]||(e[24]=l("label",{class:"form-label"},"MCI Name",-1)),d.value=="Application Installation"?(n(),s("p",Pe," Select the multi-cloud infrastructure information where the application will be deployed")):d.value=="Application Uninstallation"?(n(),s("p",Re," Remove the application and associated resources from the multi-cloud infrastructure")):f("",!0),r(l("select",{class:"form-select",id:"mci-name",disabled:u.value=="","onUpdate:modelValue":e[3]||(e[3]=a=>h.value=a),onChange:Z},[(n(!0),s(k,null,S(E.value,a=>(n(),s("option",{value:a.id,key:a.name},b(a.name),9,Fe))),128))],40,He),[[y,h.value]])]),l("div",De,[e[25]||(e[25]=l("label",{class:"form-label"},"VM Name",-1)),e[26]||(e[26]=l("p",{class:"text-muted"}," Select the virtual machine (VM) within the chosen multi-cloud infrastructure where the application will be deployed",-1)),r(l("select",{class:"form-select",id:"mci-name",disabled:h.value=="","onUpdate:modelValue":e[4]||(e[4]=a=>I.value=a)},[(n(!0),s(k,null,S(R.value,a=>(n(),s("option",{value:a.id,key:a.name},b(a.name),9,Ke))),128))],8,ze),[[y,I.value]])]),l("div",Be,[e[27]||(e[27]=l("label",{class:"form-label"},"Application",-1)),e[28]||(e[28]=l("p",{class:"text-muted"},"Select the application",-1)),r(l("select",{class:"form-select","onUpdate:modelValue":e[5]||(e[5]=a=>U.value=a),onChange:q},[(n(!0),s(k,null,S(T.value,(a,M)=>{var N,_;return n(),s("option",{key:M,value:a.name}," ["+b(a.name)+"] "+b((N=a.packageInfo)!=null&&N.packageVersion?(_=a.packageInfo)==null?void 0:_.packageVersion:"latest"),9,je)}),128))],544),[[y,U.value]])]),l("div",qe,[e[29]||(e[29]=l("label",{class:"form-label"},"Port",-1)),e[30]||(e[30]=l("p",{class:"text-muted"},"Please enter a port accessible from the outside",-1)),r(l("input",{type:"number",class:"form-control",placeholder:"8080","onUpdate:modelValue":e[6]||(e[6]=a=>$.value=a)},null,512),[[C,$.value]])])],64)):p.value=="K8S"?(n(),s(k,{key:1},[l("div",Ye,[e[31]||(e[31]=l("label",{class:"form-label"},"Namespace",-1)),d.value=="Application Installation"?(n(),s("p",Oe,"Select the namespace where the application will be installed")):d.value=="Application Uninstallation"?(n(),s("p",We,"Select the namespace where the application will be uninstalled")):f("",!0),V.value.length>0?r((n(),s("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[7]||(e[7]=a=>u.value=a),onChange:ee},[(n(!0),s(k,null,S(V.value,a=>(n(),s("option",{value:a.name,key:a.name},b(a.name),9,Ge))),128))],544)),[[y,u.value]]):r((n(),s("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[8]||(e[8]=a=>u.value=a),onChange:F},[l("option",Je,b(u.value),1)],544)),[[y,u.value]])]),l("div",Qe,[e[32]||(e[32]=l("label",{class:"form-label"},"ClusterName",-1)),d.value=="Application Installation"?(n(),s("p",Xe,"Select the name of the cluster where the application will be deployed")):d.value=="Application Uninstallation"?(n(),s("p",Ze,"Remove the application and associated resources from the multi-cloud infrastructure")):f("",!0),r(l("select",{class:"form-select",id:"mci-name",disabled:u.value=="","onUpdate:modelValue":e[9]||(e[9]=a=>x.value=a)},[(n(!0),s(k,null,S(L.value,a=>(n(),s("option",{value:a.id,key:a.name},b(a.name),9,aa))),128))],8,ea),[[y,x.value]])]),l("div",la,[e[33]||(e[33]=l("label",{class:"form-label"},"Helm chart",-1)),e[34]||(e[34]=l("p",{class:"text-muted"},"Select the application",-1)),r(l("select",{class:"form-select","onUpdate:modelValue":e[10]||(e[10]=a=>U.value=a),onChange:q},[(n(!0),s(k,null,S(T.value,(a,M)=>{var N,_;return n(),s("option",{key:M,value:a.name},b(a.name)+" / "+b((N=a.helmChart)!=null&&N.chartVersion?(_=a.helmChart)==null?void 0:_.chartVersion:"latest"),9,ta)}),128))],544),[[y,U.value]])]),d.value=="Application Installation"?(n(),s("div",sa,[e[42]||(e[42]=l("label",{class:"form-label"},"HPA Configuration",-1)),l("div",na,[l("div",oa,[r(l("input",{class:"form-check-input",type:"checkbox",id:"hpaEnabled","onUpdate:modelValue":e[11]||(e[11]=a=>m.value.hpaEnabled=a)},null,512),[[D,m.value.hpaEnabled]]),e[35]||(e[35]=l("label",{class:"form-check-label",for:"hpaEnabled"}," Enable HPA (Horizontal Pod Autoscaler) ",-1))])]),m.value.hpaEnabled?(n(),s("div",ia,[l("div",null,[e[36]||(e[36]=l("label",{class:"form-label required"}," minReplicas ",-1)),r(l("input",{type:"number",class:"form-control w-90-per",placeholder:"1","onUpdate:modelValue":e[12]||(e[12]=a=>m.value.hpaMinReplicas=a)},null,512),[[C,m.value.hpaMinReplicas]])]),l("div",null,[e[37]||(e[37]=l("label",{class:"form-label required"}," maxReplicas ",-1)),r(l("input",{type:"number",class:"form-control w-90-per",placeholder:"10","onUpdate:modelValue":e[13]||(e[13]=a=>m.value.hpaMaxReplicas=a)},null,512),[[C,m.value.hpaMaxReplicas]])]),l("div",null,[e[38]||(e[38]=l("label",{class:"form-check-label mb-2"}," CPU (%) ",-1)),r(l("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"60","onUpdate:modelValue":e[14]||(e[14]=a=>m.value.hpaCpuUtilization=a)},null,512),[[C,m.value.hpaCpuUtilization]]),e[39]||(e[39]=Y(" % "))]),l("div",null,[e[40]||(e[40]=l("label",{class:"form-check-label mb-2"}," MEMORY (%) ",-1)),r(l("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"80","onUpdate:modelValue":e[15]||(e[15]=a=>m.value.hpaMemoryUtilization=a)},null,512),[[C,m.value.hpaMemoryUtilization]]),e[41]||(e[41]=Y(" % "))])])):f("",!0)])):f("",!0),d.value=="Application Installation"?(n(),s("div",ua,[e[49]||(e[49]=l("label",{class:"form-label"},"Ingress Configuration",-1)),l("div",ra,[l("div",ca,[r(l("input",{class:"form-check-input",type:"checkbox",id:"ingressEnabled","onUpdate:modelValue":e[16]||(e[16]=a=>c.value.ingressEnabled=a)},null,512),[[D,c.value.ingressEnabled]]),e[43]||(e[43]=l("label",{class:"form-check-label",for:"ingressEnabled"}," Enable Ingress ",-1))])]),c.value.ingressEnabled?(n(),s("div",da,[l("div",pa,[e[44]||(e[44]=l("label",{class:"form-label"},"Host",-1)),r(l("input",{type:"text",class:"form-control",placeholder:"example.com","onUpdate:modelValue":e[17]||(e[17]=a=>c.value.ingressHost=a)},null,512),[[C,c.value.ingressHost]])]),l("div",ma,[e[45]||(e[45]=l("label",{class:"form-label"},"Path",-1)),r(l("input",{type:"text",class:"form-control",placeholder:"/","onUpdate:modelValue":e[18]||(e[18]=a=>c.value.ingressPath=a)},null,512),[[C,c.value.ingressPath]])]),l("div",va,[e[46]||(e[46]=l("label",{class:"form-label"},"Ingress Class",-1)),r(l("input",{type:"text",class:"form-control",placeholder:"nginx","onUpdate:modelValue":e[19]||(e[19]=a=>c.value.ingressClass=a)},null,512),[[C,c.value.ingressClass]])]),l("div",ba,[l("div",fa,[r(l("input",{class:"form-check-input",type:"checkbox",id:"ingressTlsEnabled","onUpdate:modelValue":e[20]||(e[20]=a=>c.value.ingressTlsEnabled=a)},null,512),[[D,c.value.ingressTlsEnabled]]),e[47]||(e[47]=l("label",{class:"form-check-label",for:"ingressTlsEnabled"}," Enable TLS ",-1))])]),c.value.ingressTlsEnabled?(n(),s("div",ga,[e[48]||(e[48]=l("label",{class:"form-label"},"TLS Secret Name",-1)),r(l("input",{type:"text",class:"form-control",placeholder:"tls-secret","onUpdate:modelValue":e[21]||(e[21]=a=>c.value.ingressTlsSecret=a)},null,512),[[C,c.value.ingressTlsSecret]])])):f("",!0)])):f("",!0)])):f("",!0)],64)):f("",!0)]),l("div",ha,[l("a",{class:"btn btn-link link-secondary","data-bs-dismiss":"modal",onClick:H}," Cancel "),l("div",null,[d.value=="Application Installation"?(n(),s("button",{key:0,class:"btn btn-danger ms-auto me-1",onClick:le,disabled:!w.value}," Spec Check ",8,ya)):f("",!0),l("button",{class:"btn btn-primary ms-auto","data-bs-dismiss":"modal",onClick:ae,disabled:w.value}," Deploy ",8,ka)])])])])]))}}),Ya=ce(Ca,[["__scopeId","data-v-207308ee"]]);export{Ya as A,Ua as I,ja as a,$a as b,Pa as c,_a as d,Aa as e,Ra as f,qa as g,Ha as h,La as i,Fa as j,Da as k,be as l,Ea as m,Ma as n,za as o,Ka as p,Na as q,O as r,Ba as s,Ta as u};

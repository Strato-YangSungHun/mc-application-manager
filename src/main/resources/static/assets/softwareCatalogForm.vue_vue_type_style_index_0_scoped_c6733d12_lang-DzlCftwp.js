import{c as pe}from"./IconPlus-Cz8NPRb7.js";import{d as me,u as ve,B as fe,c as be,r as p,w as ge,o as he,a as s,b as a,t as b,j as h,e as r,v as S,F as k,f as U,x as Z,g as E,y as j,l as q,h as n}from"./index-C3961WmP.js";import{_ as Y}from"./lodash-RVlGbuBg.js";import{s as i}from"./request-6pRkMXha.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";/**
 * @license @tabler/icons-vue v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Kl=pe("outline","search","IconSearch",[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]]);const ke=()=>i.get("/cbtumblebug/ns"),Ce=t=>i.get(`/cbtumblebug/ns/${t}/mci`),Ie=t=>i.get(`/cbtumblebug/ns/${t.nsId}/mci/${t.mciId}`),we=t=>i.get(`/cbtumblebug/ns/${t}/k8scluster`),Se=t=>i.get(`/catalog/software?name=${t}`),Bl=t=>i.get(`/catalog/software/${t}`),jl=t=>i.get(`/search/dockerhub/${t}`),ql=t=>i.get(`/search/artifacthub/${t}`),Ve=t=>i.post("/applications/vm/deploy",t),ee=t=>i.post("/applications/action",t),xe=t=>i.post("/applications/k8s/deploy",t),Ue=t=>i.get(`/applications/vm/check?namespace=${t.namespace}&mciId=${t.mciName}&vmId=${t.vmName}&catalogId=${t.catalogId}`),Ee=t=>i.get(`/applications/k8s/check?namespace=${t.namespace}&clusterName=${t.clusterName}&catalogId=${t.catalogId}`),Yl=t=>i.get(`/ape/log/${t}`);function Ol(t){return i.post("/catalog/software",t)}function Wl(t){return i.put(`/catalog/software/${t.id}`,t)}function Xl(t){return i.delete(`/catalog/software/${t}`)}function Gl(){return i.get("/api/applications/status/groups")}function Jl(t){return i.post("/catalog/application/category",t)}function Ql(t){return i.post("/catalog/application/package",t)}function Zl(t){const C={target:t.target,applicationName:t.packageName};return i.post("/catalog/application/package/version",C)}function ea(t){return i.get(`/search/dockerhub/tag/${t.path}`)}function la(t){return i.get(`/search/artifacthub/version/${t.kind}/${t.repository}/${t.packageName}`)}function aa(t){return i.post("/catalog/docker/register",t)}function ta(t){return i.post("/catalog/helm/register",t)}function sa(t){return i.post("/catalog/rating/overall",t)}function na(t){return i.get(`/api/applications/integrated/deployment/${t}`)}function oa(t){return i.get(`/catalog/selectbox/options?type=${t}`)}const Me={class:"modal fade",id:"install-form",tabindex:"-1"},Ae={class:"modal-dialog modal-lg",role:"document"},Ne={class:"modal-content"},Te={class:"modal-header"},Le={class:"modal-title"},$e={class:"modal-body",style:{"max-height":"calc(100vh - 200px)","overflow-y":"auto"}},_e={class:"mb-3"},Pe={key:0,class:"text-muted"},Re={key:1,class:"text-muted"},He=["value"],De={class:"mb-3"},Fe={key:0,class:"text-muted"},ze={key:1,class:"text-muted"},Ke=["value"],Be={value:"selectNsId"},je={class:"mb-3"},qe={key:0,class:"text-muted"},Ye={key:1,class:"text-muted"},Oe=["disabled"],We=["value"],Xe={class:"mb-3"},Ge=["disabled"],Je=["value"],Qe={key:0,class:"mt-2",style:{display:"flex",gap:"10px","flex-wrap":"wrap"}},Ze=["onClick"],el={class:"mb-3"},ll={style:{display:"flex",gap:"10px"}},al={class:"form-check"},tl={class:"form-check"},sl={class:"mb-3"},nl=["value"],ol={class:"mb-3"},il={class:"mb-3"},ul={key:0,class:"text-muted"},rl={key:1,class:"text-muted"},cl=["value"],dl={value:"selectNsId"},pl={class:"mb-3"},ml={key:0,class:"text-muted"},vl={key:1,class:"text-muted"},fl=["disabled"],bl=["value"],gl={class:"mb-3"},hl=["value"],yl={key:0,class:"mb-3"},kl={class:"mb-2"},Cl={class:"form-check"},Il={key:0,class:"d-flex justify-content-between"},wl={key:1,class:"mb-3"},Sl={class:"mb-2"},Vl={class:"form-check"},xl={key:0},Ul={class:"mb-2"},El={class:"mb-2"},Ml={class:"mb-2"},Al={class:"mb-2"},Nl={class:"form-check"},Tl={key:0,class:"mb-2"},Ll={class:"modal-footer d-flex justify-content-between"},$l=["disabled"],_l=["disabled"],Pl=me({__name:"applicationInstallationForm",props:{nsId:{},title:{}},setup(t){const C=ve(),O=fe(),z=t,d=be(()=>z.title),W=p([]),V=p([]),R=p([]),A=p([]),L=p([]),H=p([]),m=p(""),u=p(""),I=p(""),w=p(""),f=p([]),g=p("Standalone"),v=p({}),c=p({}),D=p([]),N=p(""),x=p(""),F=p(""),M=p(!0);ge(g,()=>{g.value==="Standalone"?(f.value=[],A.value=[...L.value]):g.value==="Clustering"&&(f.value=[],A.value=[...L.value])}),he(async()=>{document.getElementById("install-form").addEventListener("show.bs.modal",async()=>{await K(),await le()})});const K=async()=>{m.value="VM",u.value="",I.value="",w.value="",f.value=[],L.value=[],g.value="Standalone",v.value={hpaEnabled:!1,hpaMinReplicas:1,hpaMaxReplicas:10,hpaCpuUtilization:60,hpaMemoryUtilization:80},c.value={ingressEnabled:!1,ingressHost:"",ingressPath:"/",ingressClass:"nginx",ingressTlsEnabled:!1,ingressTlsSecret:""},ae(),te(),await se()},le=async()=>{await Se("").then(({data:o})=>{H.value=o})},ae=()=>{W.value=[{key:"VM",value:"VM"},{key:"k8s",value:"K8S"}]},te=()=>{d.value==="Application Uninstallation"?M.value=!1:M.value=!0},se=async()=>{await ke().then(async({data:o})=>{if(console.log("## data ### : ",o),V.value=o,V.value.length>0)if(!Y.isEmpty(z.nsId))u.value=z.nsId;else if(Y.isEmpty(O.getNsId()))u.value=V.value[0].name;else{const e=O.getNsId();V.value.find(y=>y.name===e)?u.value=e:u.value=V.value[0].name}Y.isEmpty(u.value)||(m.value==="VM"?await X():m.value==="K8S"&&await J())})},X=async()=>{await Ce(u.value).then(async({data:o})=>{R.value=o,R.value.length>0?(I.value=R.value[0].name,await G()):I.value=""})},G=async()=>{const o={nsId:u.value,mciId:I.value};await Ie(o).then(({data:e})=>{L.value=e.vm,A.value=L.value.filter(l=>!f.value.includes(l.id)),w.value=""})},J=async()=>{await we(u.value).then(({data:o})=>{D.value=o,D.value.length>0?N.value=D.value[0].name:N.value=""})},B=async()=>{f.value=[],await X(),$()},ne=async()=>{f.value=[],await G(),$()},oe=async()=>{await J(),$()},$=()=>{d.value==="Application Installation"?M.value=!0:d.value==="Application Uninstallation"&&(M.value=!1)},ie=()=>{if(w.value!==""){if(g.value==="Standalone")f.value=[w.value];else if(g.value==="Clustering"&&!f.value.includes(w.value)){f.value.push(w.value);const o=A.value.findIndex(e=>e.id===w.value);o!==-1&&A.value.splice(o,1)}w.value="",$()}},ue=o=>{const e=f.value[o];if(f.value.splice(o,1),g.value==="Clustering"){const l=L.value.find(y=>y.id===e);l&&A.value.push(l)}$()},re=async()=>{let o={};if(m.value==="VM"){x.value.split(",").map(l=>l.toLowerCase().trim());let e={};if(d.value=="Application Installation"){const l=g.value==="Clustering"?`${x.value}-cluster`:`${x.value}-standalone`;e={namespace:u.value,mciId:I.value,vmIds:f.value,clusterName:l,catalogId:T.value,servicePort:F.value,username:"admin",deploymentType:m.value,vmDeploymentMode:g.value.toUpperCase()},o=await Ve(e)}else o=await ee(e);o.data?C.success("SUCCESS"):C.error("FAIL")}else if(m.value==="K8S"){x.value.split(",").map(l=>l.toLowerCase().trim());let e={namespace:u.value,clusterName:N.value,catalogId:T.value,servicePort:F.value,username:"",deploymentType:m.value,hpaEnabled:v.value.hpaEnabled,minReplicas:v.value.hpaMinReplicas,maxReplicas:v.value.hpaMaxReplicas,cpuThreshold:v.value.hpaCpuUtilization,memoryThreshold:v.value.hpaMemoryUtilization,ingressEnabled:c.value.ingressEnabled,ingressHost:c.value.ingressHost,ingressPath:c.value.ingressPath,ingressClass:c.value.ingressClass,ingressTlsEnabled:c.value.ingressTlsEnabled,ingressTlsSecret:c.value.ingressTlsSecret};d.value=="Application Installation"?o=await xe(e):o=await ee(e),o.data?C.success("SUCCESS"):C.error("FAIL")}},ce=async()=>{m.value==="VM"||m.value==="K8S"?de().then(o=>{let e=!0;if(o===null){C.error("Please select all items");return}else if(o===!1){let l="";m.value==="VM"?l="VM":m.value==="K8S"&&(l="CLUSTER");const y="Your selected "+l+" has lower specifications than recommended. Would you like to continue with the installation?";e=confirm(y)}e&&(C.success("Please click RUN"),M.value=!1)}):C.error("Please Select Infra")},de=async()=>{let o=!1;if(m.value==="VM"){if(u.value===""||I.value===""||f.value.length===0||T.value===0)return null;{const e={namespace:u.value,mciName:I.value,vmName:f.value[0],catalogId:T.value};await Ue(e).then(({data:l})=>{o=l})}}else if(m.value==="K8S"){if(u.value===""||N.value===""||T.value===0){C.error("Please select all items");return}const e={namespace:u.value,clusterName:N.value,catalogId:T.value};await Ee(e).then(({data:l})=>{o=l})}return o},T=p(0),Q=()=>{d.value==="Application Installation"&&(M.value=!0),H.value.forEach(o=>{if(x.value===o.name){T.value=o.id;return}})};return(o,e)=>(n(),s("div",Me,[a("div",Ae,[a("div",Ne,[a("div",Te,[a("h5",Le,b(d.value),1),a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:K})]),a("div",$e,[a("div",_e,[e[24]||(e[24]=a("label",{class:"form-label"},"Target Infra",-1)),d.value=="Application Installation"?(n(),s("p",Pe," Select the Infra what is the Infra will be installed ")):d.value=="Application Uninstallation"?(n(),s("p",Re," Select the Infra what is the Infra will be uninstalled ")):h("",!0),r(a("select",{class:"form-select",id:"infra","onUpdate:modelValue":e[0]||(e[0]=l=>m.value=l),onClick:$},[(n(!0),s(k,null,U(W.value,l=>(n(),s("option",{value:l.value,key:l.value},b(l.value),9,He))),128))],512),[[S,m.value]])]),m.value=="VM"?(n(),s(k,{key:0},[a("div",De,[e[25]||(e[25]=a("label",{class:"form-label"},"Namespace",-1)),d.value=="Application Installation"?(n(),s("p",Fe," Select the namespace where the application will be installed")):d.value=="Application Uninstallation"?(n(),s("p",ze," Select the namespace where the application will be uninstalled")):h("",!0),V.value.length>0?r((n(),s("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[1]||(e[1]=l=>u.value=l),onChange:B},[(n(!0),s(k,null,U(V.value,l=>(n(),s("option",{value:l.name,key:l.name},b(l.name),9,Ke))),128))],544)),[[S,u.value]]):r((n(),s("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[2]||(e[2]=l=>u.value=l),onChange:B},[a("option",Be,b(u.value),1)],544)),[[S,u.value]])]),a("div",je,[e[26]||(e[26]=a("label",{class:"form-label"},"MCI Name",-1)),d.value=="Application Installation"?(n(),s("p",qe," Select the multi-cloud infrastructure information where the application will be deployed")):d.value=="Application Uninstallation"?(n(),s("p",Ye," Remove the application and associated resources from the multi-cloud infrastructure")):h("",!0),r(a("select",{class:"form-select",id:"mci-name",disabled:u.value=="","onUpdate:modelValue":e[3]||(e[3]=l=>I.value=l),onChange:ne},[(n(!0),s(k,null,U(R.value,l=>(n(),s("option",{value:l.id,key:l.name},b(l.name),9,We))),128))],40,Oe),[[S,I.value]])]),a("div",Xe,[e[28]||(e[28]=a("label",{class:"form-label"},"VM Name",-1)),e[29]||(e[29]=a("p",{class:"text-muted"}," Select the virtual machine (VM) within the chosen multi-cloud infrastructure where the application will be deployed",-1)),r(a("select",{class:"form-select",id:"mci-name",disabled:I.value=="","onUpdate:modelValue":e[4]||(e[4]=l=>w.value=l),onChange:ie},[e[27]||(e[27]=a("option",{value:""},"Select VM",-1)),(n(!0),s(k,null,U(A.value,l=>(n(),s("option",{value:l.id,key:l.name},b(l.name),9,Je))),128))],40,Ge),[[S,w.value]]),f.value.length>0?(n(),s("div",Qe,[(n(!0),s(k,null,U(f.value,(l,y)=>(n(),s("label",{key:y,class:"form-check-label",style:{border:"1px solid #000",padding:"5px","border-radius":"5px",cursor:"pointer"}},[q(b(l)+" ",1),a("span",{onClick:_=>ue(y),style:{"margin-left":"5px","font-weight":"bold"}},"X",8,Ze)]))),128))])):h("",!0)]),a("div",el,[e[32]||(e[32]=a("label",{class:"form-label"},"Deployment Type",-1)),e[33]||(e[33]=a("p",{class:"text-muted"},"Select the deployment type",-1)),a("div",ll,[a("div",al,[r(a("input",{class:"form-check-input",type:"radio",id:"Standalone","onUpdate:modelValue":e[5]||(e[5]=l=>g.value=l),value:"Standalone"},null,512),[[Z,g.value]]),e[30]||(e[30]=a("label",{class:"form-check-label",for:"Standalone"},"Standalone",-1))]),a("div",tl,[r(a("input",{class:"form-check-input",type:"radio",id:"Clustering","onUpdate:modelValue":e[6]||(e[6]=l=>g.value=l),value:"Clustering"},null,512),[[Z,g.value]]),e[31]||(e[31]=a("label",{class:"form-check-label",for:"Clustering"},"Clustering",-1))])])]),a("div",sl,[e[34]||(e[34]=a("label",{class:"form-label"},"Application",-1)),e[35]||(e[35]=a("p",{class:"text-muted"},"Select the application",-1)),r(a("select",{class:"form-select","onUpdate:modelValue":e[7]||(e[7]=l=>x.value=l),onChange:Q},[(n(!0),s(k,null,U(H.value,(l,y)=>{var _,P;return n(),s("option",{key:y,value:l.name}," ["+b(l.name)+"] "+b((_=l.packageInfo)!=null&&_.packageVersion?(P=l.packageInfo)==null?void 0:P.packageVersion:"latest"),9,nl)}),128))],544),[[S,x.value]])]),a("div",ol,[e[36]||(e[36]=a("label",{class:"form-label"},"Port",-1)),e[37]||(e[37]=a("p",{class:"text-muted"},"Please enter a port accessible from the outside",-1)),r(a("input",{type:"number",class:"form-control",placeholder:"8080","onUpdate:modelValue":e[8]||(e[8]=l=>F.value=l)},null,512),[[E,F.value]])])],64)):m.value=="K8S"?(n(),s(k,{key:1},[a("div",il,[e[38]||(e[38]=a("label",{class:"form-label"},"Namespace",-1)),d.value=="Application Installation"?(n(),s("p",ul,"Select the namespace where the application will be installed")):d.value=="Application Uninstallation"?(n(),s("p",rl,"Select the namespace where the application will be uninstalled")):h("",!0),V.value.length>0?r((n(),s("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[9]||(e[9]=l=>u.value=l),onChange:oe},[(n(!0),s(k,null,U(V.value,l=>(n(),s("option",{value:l.name,key:l.name},b(l.name),9,cl))),128))],544)),[[S,u.value]]):r((n(),s("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[10]||(e[10]=l=>u.value=l),onChange:B},[a("option",dl,b(u.value),1)],544)),[[S,u.value]])]),a("div",pl,[e[39]||(e[39]=a("label",{class:"form-label"},"ClusterName",-1)),d.value=="Application Installation"?(n(),s("p",ml,"Select the name of the cluster where the application will be deployed")):d.value=="Application Uninstallation"?(n(),s("p",vl,"Remove the application and associated resources from the multi-cloud infrastructure")):h("",!0),r(a("select",{class:"form-select",id:"mci-name",disabled:u.value=="","onUpdate:modelValue":e[11]||(e[11]=l=>N.value=l)},[(n(!0),s(k,null,U(D.value,l=>(n(),s("option",{value:l.id,key:l.name},b(l.name),9,bl))),128))],8,fl),[[S,N.value]])]),a("div",gl,[e[40]||(e[40]=a("label",{class:"form-label"},"Helm chart",-1)),e[41]||(e[41]=a("p",{class:"text-muted"},"Select the application",-1)),r(a("select",{class:"form-select","onUpdate:modelValue":e[12]||(e[12]=l=>x.value=l),onChange:Q},[(n(!0),s(k,null,U(H.value,(l,y)=>{var _,P;return n(),s("option",{key:y,value:l.name},b(l.name)+" / "+b((_=l.helmChart)!=null&&_.chartVersion?(P=l.helmChart)==null?void 0:P.chartVersion:"latest"),9,hl)}),128))],544),[[S,x.value]])]),d.value=="Application Installation"?(n(),s("div",yl,[e[49]||(e[49]=a("label",{class:"form-label"},"HPA Configuration",-1)),a("div",kl,[a("div",Cl,[r(a("input",{class:"form-check-input",type:"checkbox",id:"hpaEnabled","onUpdate:modelValue":e[13]||(e[13]=l=>v.value.hpaEnabled=l)},null,512),[[j,v.value.hpaEnabled]]),e[42]||(e[42]=a("label",{class:"form-check-label",for:"hpaEnabled"}," Enable HPA (Horizontal Pod Autoscaler) ",-1))])]),v.value.hpaEnabled?(n(),s("div",Il,[a("div",null,[e[43]||(e[43]=a("label",{class:"form-label required"}," minReplicas ",-1)),r(a("input",{type:"number",class:"form-control w-90-per",placeholder:"1","onUpdate:modelValue":e[14]||(e[14]=l=>v.value.hpaMinReplicas=l)},null,512),[[E,v.value.hpaMinReplicas]])]),a("div",null,[e[44]||(e[44]=a("label",{class:"form-label required"}," maxReplicas ",-1)),r(a("input",{type:"number",class:"form-control w-90-per",placeholder:"10","onUpdate:modelValue":e[15]||(e[15]=l=>v.value.hpaMaxReplicas=l)},null,512),[[E,v.value.hpaMaxReplicas]])]),a("div",null,[e[45]||(e[45]=a("label",{class:"form-check-label mb-2"}," CPU (%) ",-1)),r(a("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"60","onUpdate:modelValue":e[16]||(e[16]=l=>v.value.hpaCpuUtilization=l)},null,512),[[E,v.value.hpaCpuUtilization]]),e[46]||(e[46]=q(" % "))]),a("div",null,[e[47]||(e[47]=a("label",{class:"form-check-label mb-2"}," MEMORY (%) ",-1)),r(a("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"80","onUpdate:modelValue":e[17]||(e[17]=l=>v.value.hpaMemoryUtilization=l)},null,512),[[E,v.value.hpaMemoryUtilization]]),e[48]||(e[48]=q(" % "))])])):h("",!0)])):h("",!0),d.value=="Application Installation"?(n(),s("div",wl,[e[56]||(e[56]=a("label",{class:"form-label"},"Ingress Configuration",-1)),a("div",Sl,[a("div",Vl,[r(a("input",{class:"form-check-input",type:"checkbox",id:"ingressEnabled","onUpdate:modelValue":e[18]||(e[18]=l=>c.value.ingressEnabled=l)},null,512),[[j,c.value.ingressEnabled]]),e[50]||(e[50]=a("label",{class:"form-check-label",for:"ingressEnabled"}," Enable Ingress ",-1))])]),c.value.ingressEnabled?(n(),s("div",xl,[a("div",Ul,[e[51]||(e[51]=a("label",{class:"form-label"},"Host",-1)),r(a("input",{type:"text",class:"form-control",placeholder:"example.com","onUpdate:modelValue":e[19]||(e[19]=l=>c.value.ingressHost=l)},null,512),[[E,c.value.ingressHost]])]),a("div",El,[e[52]||(e[52]=a("label",{class:"form-label"},"Path",-1)),r(a("input",{type:"text",class:"form-control",placeholder:"/","onUpdate:modelValue":e[20]||(e[20]=l=>c.value.ingressPath=l)},null,512),[[E,c.value.ingressPath]])]),a("div",Ml,[e[53]||(e[53]=a("label",{class:"form-label"},"Ingress Class",-1)),r(a("input",{type:"text",class:"form-control",placeholder:"nginx","onUpdate:modelValue":e[21]||(e[21]=l=>c.value.ingressClass=l)},null,512),[[E,c.value.ingressClass]])]),a("div",Al,[a("div",Nl,[r(a("input",{class:"form-check-input",type:"checkbox",id:"ingressTlsEnabled","onUpdate:modelValue":e[22]||(e[22]=l=>c.value.ingressTlsEnabled=l)},null,512),[[j,c.value.ingressTlsEnabled]]),e[54]||(e[54]=a("label",{class:"form-check-label",for:"ingressTlsEnabled"}," Enable TLS ",-1))])]),c.value.ingressTlsEnabled?(n(),s("div",Tl,[e[55]||(e[55]=a("label",{class:"form-label"},"TLS Secret Name",-1)),r(a("input",{type:"text",class:"form-control",placeholder:"tls-secret","onUpdate:modelValue":e[23]||(e[23]=l=>c.value.ingressTlsSecret=l)},null,512),[[E,c.value.ingressTlsSecret]])])):h("",!0)])):h("",!0)])):h("",!0)],64)):h("",!0)]),a("div",Ll,[a("a",{class:"btn btn-link link-secondary","data-bs-dismiss":"modal",onClick:K}," Cancel "),a("div",null,[d.value=="Application Installation"?(n(),s("button",{key:0,class:"btn btn-danger ms-auto me-1",onClick:ce,disabled:!M.value}," Spec Check ",8,$l)):h("",!0),a("button",{class:"btn btn-primary ms-auto","data-bs-dismiss":"modal",onClick:re,disabled:M.value}," Deploy ",8,_l)])])])])]))}}),ia=ye(Pl,[["__scopeId","data-v-d5c7b5ec"]]);export{ia as A,Kl as I,na as a,Gl as b,Jl as c,Ol as d,Bl as e,Ql as f,oa as g,Zl as h,Xl as i,ea as j,la as k,Se as l,jl as m,ql as n,aa as o,ta as p,Yl as q,ee as r,sa as s,Wl as u};

import{c as ae}from"./IconPlus-3xp-XtA_.js";import{d as le,u as te,c as se,r as v,o as ne,a as s,b as l,t as f,j as b,e as r,v as y,F as k,f as S,g as I,y as H,l as j,h as n}from"./index-m3Ti63A1.js";import{_ as oe}from"./lodash-DjL3yUU0.js";import{s as i}from"./request-DYvQt4Sf.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";/**
 * @license @tabler/icons-vue v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Sa=ae("outline","search","IconSearch",[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]]);const ue=()=>i.get("/cbtumblebug/ns"),re=t=>i.get(`/cbtumblebug/ns/${t}/mci`),ce=t=>i.get(`/cbtumblebug/ns/${t.nsId}/mci/${t.mciId}`),de=t=>i.get(`/cbtumblebug/ns/${t}/k8scluster`),pe=t=>i.get(`/catalog/software?name=${t}`),Va=t=>i.get(`/catalog/software/${t}`),xa=t=>i.get(`/search/dockerhub/${t}`),Ua=t=>i.get(`/search/artifacthub/${t}`),me=t=>i.post("/applications/vm/deploy",t),ve=t=>i.get(`/applications/vm/action?operation=${t.operation}&applicationStatusId=${t.applicationStatusId}&reason=${t.reason}`),be=t=>i.post("/applications/k8s/deploy",t),fe=t=>i.get(`/applications/k8s/action?operation=${t.operation}&applicationStatusId=${t.applicationStatusId}&reason=${t.reason}`),ge=t=>i.get(`/applications/vm/check?namespace=${t.namespace}&mciId=${t.mciName}&vmId=${t.vmName}&catalogId=${t.catalogId}`),he=t=>i.get(`/applications/k8s/check?namespace=${t.namespace}&clusterName=${t.clusterName}&catalogId=${t.catalogId}`),Aa=t=>i.get(`/ape/log/${t}`);function Ea(t){return i.post("/catalog/software",t)}function Ma(t){return i.put(`/catalog/software/${t.id}`,t)}function Na(t){return i.delete(`/catalog/software/${t}`)}function $a(){return i.get("/api/applications/status/groups")}function Ta(t){return i.post("/catalog/application/category",t)}function La(t){return i.post("/catalog/application/package",t)}function _a(t){const g={target:t.target,applicationName:t.packageName};return i.post("/catalog/application/package/version",g)}function Pa(t){return i.get(`/search/dockerhub/tag/${t.path}`)}function Ra(t){return i.get(`/search/artifacthub/version/${t.kind}/${t.repository}/${t.packageName}`)}function Ha(t){return i.post("/catalog/docker/register",t)}function Fa(t){return i.post("/catalog/helm/register",t)}function Da(t){return i.post("/catalog/rating/overall",t)}function za(t){return i.get(`/api/applications/integrated/deployment/${t}`)}const ye={class:"modal fade",id:"install-form",tabindex:"-1"},ke={class:"modal-dialog modal-lg",role:"document"},Ie={class:"modal-content"},Ce={class:"modal-header"},we={class:"modal-title"},Se={class:"modal-body",style:{"max-height":"calc(100vh - 200px)","overflow-y":"auto"}},Ve={class:"mb-3"},xe={key:0,class:"text-muted"},Ue={key:1,class:"text-muted"},Ae=["value"],Ee={class:"mb-3"},Me={key:0,class:"text-muted"},Ne={key:1,class:"text-muted"},$e=["value"],Te={value:"selectNsId"},Le={class:"mb-3"},_e={key:0,class:"text-muted"},Pe={key:1,class:"text-muted"},Re=["disabled"],He=["value"],Fe={class:"mb-3"},De=["disabled"],ze=["value"],Ke={class:"mb-3"},Be={class:"mb-3"},je={class:"mb-3"},qe={key:0,class:"text-muted"},Ye={key:1,class:"text-muted"},Oe=["value"],We={value:"selectNsId"},Ge={class:"mb-3"},Je={key:0,class:"text-muted"},Qe={key:1,class:"text-muted"},Xe=["disabled"],Ze=["value"],ea={class:"mb-3"},aa={key:0,class:"mb-3"},la={class:"mb-2"},ta={class:"form-check"},sa={key:0,class:"d-flex justify-content-between"},na={key:1,class:"mb-3"},oa={class:"mb-2"},ia={class:"form-check"},ua={key:0},ra={class:"mb-2"},ca={class:"mb-2"},da={class:"mb-2"},pa={class:"mb-2"},ma={class:"form-check"},va={key:0,class:"mb-2"},ba={class:"modal-footer d-flex justify-content-between"},fa=["disabled"],ga=["disabled"],ha=le({__name:"applicationInstallationForm",props:{nsId:{},title:{}},setup(t){const g=te(),q=t,d=se(()=>q.title),F=v([]),V=v([]),E=v([]),_=v([]),N=v([]),p=v(""),u=v(""),h=v(""),C=v(""),m=v({}),c=v({}),$=v([]),x=v(""),U=v(""),T=v(""),w=v(!0);ne(async()=>{document.getElementById("install-form").addEventListener("show.bs.modal",async()=>{await P(),await Y()})});const P=async()=>{p.value="VM",u.value="",h.value="",C.value="",m.value={hpaEnabled:!1,hpaMinReplicas:1,hpaMaxReplicas:10,hpaCpuUtilization:60,hpaMemoryUtilization:80},c.value={ingressEnabled:!1,ingressHost:"",ingressPath:"/",ingressClass:"nginx",ingressTlsEnabled:!1,ingressTlsSecret:""},O(),W(),await G()},Y=async()=>{await pe("").then(({data:o})=>{N.value=o})},O=()=>{F.value=[{key:"VM",value:"VM"},{key:"k8s",value:"K8S"}]},W=()=>{d.value==="Application Uninstallation"?w.value=!1:w.value=!0},G=async()=>{await ue().then(async({data:o})=>{V.value=o,V.value.length>0&&(u.value=V.value[0].name),oe.isEmpty(u.value)||(p.value==="VM"?await D():p.value==="K8S"&&await K())})},D=async()=>{await re(u.value).then(async({data:o})=>{E.value=o,E.value.length>0?(h.value=E.value[0].name,await z()):h.value=""})},z=async()=>{const o={nsId:u.value,mciId:h.value};await ce(o).then(({data:e})=>{_.value=e.vm,E.value.length>0?C.value=_.value[0].name:C.value=""})},K=async()=>{await de(u.value).then(({data:o})=>{$.value=o,$.value.length>0?x.value=$.value[0].name:x.value=""})},R=async()=>{await D(),L()},J=async()=>{await z(),L()},Q=async()=>{await K(),L()},L=()=>{d.value==="Application Installation"?w.value=!0:d.value==="Application Uninstallation"&&(w.value=!1)},X=async()=>{let o={};if(p.value==="VM"){U.value.split(",").map(a=>a.toLowerCase().trim());let e={};d.value=="Application Installation"?(e={namespace:u.value,mciId:h.value,vmId:C.value,catalogId:A.value,servicePort:T.value,username:"",deploymentType:p.value},o=await me(e)):o=await ve(e),o.data?g.success("SUCCESS"):g.error("FAIL")}else if(p.value==="K8S"){U.value.split(",").map(a=>a.toLowerCase().trim());let e={namespace:u.value,clusterName:x.value,catalogId:A.value,servicePort:T.value,username:"",deploymentType:p.value,hpaEnabled:m.value.hpaEnabled,minReplicas:m.value.hpaMinReplicas,maxReplicas:m.value.hpaMaxReplicas,cpuThreshold:m.value.hpaCpuUtilization,memoryThreshold:m.value.hpaMemoryUtilization,ingressEnabled:c.value.ingressEnabled,ingressHost:c.value.ingressHost,ingressPath:c.value.ingressPath,ingressClass:c.value.ingressClass,ingressTlsEnabled:c.value.ingressTlsEnabled,ingressTlsSecret:c.value.ingressTlsSecret};d.value=="Application Installation"?o=await be(e):o=await fe(e),o.data?g.success("SUCCESS"):g.error("FAIL")}},Z=async()=>{p.value==="VM"||p.value==="K8S"?ee().then(o=>{let e=!0;if(o===null){g.error("Please select all items");return}else if(o===!1){let a="";p.value==="VM"?a="VM":p.value==="K8S"&&(a="CLUSTER");const M="Your selected "+a+" has lower specifications than recommended. Would you like to continue with the installation?";e=confirm(M)}e&&(g.success("Please click RUN"),w.value=!1)}):g.error("Please Select Infra")},ee=async()=>{let o=!1;if(p.value==="VM"){if(u.value===""||h.value===""||C.value===""||A.value===0)return null;{const e={namespace:u.value,mciName:h.value,vmName:C.value,catalogId:A.value};await ge(e).then(({data:a})=>{o=a})}}else if(p.value==="K8S"){if(u.value===""||x.value===""||A.value===0){g.error("Please select all items");return}const e={namespace:u.value,clusterName:x.value,catalogId:A.value};await he(e).then(({data:a})=>{o=a})}return o},A=v(0),B=()=>{d.value==="Application Installation"&&(w.value=!0),N.value.forEach(o=>{if(U.value===o.name){A.value=o.id;return}})};return(o,e)=>(n(),s("div",ye,[l("div",ke,[l("div",Ie,[l("div",Ce,[l("h5",we,f(d.value),1),l("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:P})]),l("div",Se,[l("div",Ve,[e[22]||(e[22]=l("label",{class:"form-label"},"Target Infra",-1)),d.value=="Application Installation"?(n(),s("p",xe," Select the Infra what is the Infra will be installed ")):d.value=="Application Uninstallation"?(n(),s("p",Ue," Select the Infra what is the Infra will be uninstalled ")):b("",!0),r(l("select",{class:"form-select",id:"infra","onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),onClick:L},[(n(!0),s(k,null,S(F.value,a=>(n(),s("option",{value:a.value,key:a.value},f(a.value),9,Ae))),128))],512),[[y,p.value]])]),p.value=="VM"?(n(),s(k,{key:0},[l("div",Ee,[e[23]||(e[23]=l("label",{class:"form-label"},"Namespace",-1)),d.value=="Application Installation"?(n(),s("p",Me," Select the namespace where the application will be installed")):d.value=="Application Uninstallation"?(n(),s("p",Ne," Select the namespace where the application will be uninstalled")):b("",!0),V.value.length>0?r((n(),s("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[1]||(e[1]=a=>u.value=a),onChange:R},[(n(!0),s(k,null,S(V.value,a=>(n(),s("option",{value:a.name,key:a.name},f(a.name),9,$e))),128))],544)),[[y,u.value]]):r((n(),s("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[2]||(e[2]=a=>u.value=a),onChange:R},[l("option",Te,f(u.value),1)],544)),[[y,u.value]])]),l("div",Le,[e[24]||(e[24]=l("label",{class:"form-label"},"MCI Name",-1)),d.value=="Application Installation"?(n(),s("p",_e," Select the multi-cloud infrastructure information where the application will be deployed")):d.value=="Application Uninstallation"?(n(),s("p",Pe," Remove the application and associated resources from the multi-cloud infrastructure")):b("",!0),r(l("select",{class:"form-select",id:"mci-name",disabled:u.value=="","onUpdate:modelValue":e[3]||(e[3]=a=>h.value=a),onChange:J},[(n(!0),s(k,null,S(E.value,a=>(n(),s("option",{value:a.id,key:a.name},f(a.name),9,He))),128))],40,Re),[[y,h.value]])]),l("div",Fe,[e[25]||(e[25]=l("label",{class:"form-label"},"VM Name",-1)),e[26]||(e[26]=l("p",{class:"text-muted"}," Select the virtual machine (VM) within the chosen multi-cloud infrastructure where the application will be deployed",-1)),r(l("select",{class:"form-select",id:"mci-name",disabled:h.value=="","onUpdate:modelValue":e[4]||(e[4]=a=>C.value=a)},[(n(!0),s(k,null,S(_.value,a=>(n(),s("option",{value:a.id,key:a.name},f(a.name),9,ze))),128))],8,De),[[y,C.value]])]),l("div",Ke,[e[27]||(e[27]=l("label",{class:"form-label"},"Application",-1)),e[28]||(e[28]=l("p",{class:"text-muted"},"Select the application",-1)),r(l("select",{class:"form-select","onUpdate:modelValue":e[5]||(e[5]=a=>U.value=a),onChange:B},[(n(!0),s(k,null,S(N.value,(a,M)=>(n(),s("option",{key:M},f(a.name),1))),128))],544),[[y,U.value]])]),l("div",Be,[e[29]||(e[29]=l("label",{class:"form-label"},"Port",-1)),e[30]||(e[30]=l("p",{class:"text-muted"},"Please enter a port accessible from the outside",-1)),r(l("input",{type:"number",class:"form-control",placeholder:"8080","onUpdate:modelValue":e[6]||(e[6]=a=>T.value=a)},null,512),[[I,T.value]])])],64)):p.value=="K8S"?(n(),s(k,{key:1},[l("div",je,[e[31]||(e[31]=l("label",{class:"form-label"},"Namespace",-1)),d.value=="Application Installation"?(n(),s("p",qe,"Select the namespace where the application will be installed")):d.value=="Application Uninstallation"?(n(),s("p",Ye,"Select the namespace where the application will be uninstalled")):b("",!0),V.value.length>0?r((n(),s("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[7]||(e[7]=a=>u.value=a),onChange:Q},[(n(!0),s(k,null,S(V.value,a=>(n(),s("option",{value:a.name,key:a.name},f(a.name),9,Oe))),128))],544)),[[y,u.value]]):r((n(),s("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[8]||(e[8]=a=>u.value=a),onChange:R},[l("option",We,f(u.value),1)],544)),[[y,u.value]])]),l("div",Ge,[e[32]||(e[32]=l("label",{class:"form-label"},"ClusterName",-1)),d.value=="Application Installation"?(n(),s("p",Je,"Select the name of the cluster where the application will be deployed")):d.value=="Application Uninstallation"?(n(),s("p",Qe,"Remove the application and associated resources from the multi-cloud infrastructure")):b("",!0),r(l("select",{class:"form-select",id:"mci-name",disabled:u.value=="","onUpdate:modelValue":e[9]||(e[9]=a=>x.value=a)},[(n(!0),s(k,null,S($.value,a=>(n(),s("option",{value:a.id,key:a.name},f(a.name),9,Ze))),128))],8,Xe),[[y,x.value]])]),l("div",ea,[e[33]||(e[33]=l("label",{class:"form-label"},"Helm chart",-1)),e[34]||(e[34]=l("p",{class:"text-muted"},"Select the application",-1)),r(l("select",{class:"form-select","onUpdate:modelValue":e[10]||(e[10]=a=>U.value=a),onChange:B},[(n(!0),s(k,null,S(N.value,(a,M)=>(n(),s("option",{key:M},f(a.name),1))),128))],544),[[y,U.value]])]),d.value=="Application Installation"?(n(),s("div",aa,[e[42]||(e[42]=l("label",{class:"form-label"},"HPA Configuration",-1)),l("div",la,[l("div",ta,[r(l("input",{class:"form-check-input",type:"checkbox",id:"hpaEnabled","onUpdate:modelValue":e[11]||(e[11]=a=>m.value.hpaEnabled=a)},null,512),[[H,m.value.hpaEnabled]]),e[35]||(e[35]=l("label",{class:"form-check-label",for:"hpaEnabled"}," Enable HPA (Horizontal Pod Autoscaler) ",-1))])]),m.value.hpaEnabled?(n(),s("div",sa,[l("div",null,[e[36]||(e[36]=l("label",{class:"form-label required"}," minReplicas ",-1)),r(l("input",{type:"number",class:"form-control w-90-per",placeholder:"1","onUpdate:modelValue":e[12]||(e[12]=a=>m.value.hpaMinReplicas=a)},null,512),[[I,m.value.hpaMinReplicas]])]),l("div",null,[e[37]||(e[37]=l("label",{class:"form-label required"}," maxReplicas ",-1)),r(l("input",{type:"number",class:"form-control w-90-per",placeholder:"10","onUpdate:modelValue":e[13]||(e[13]=a=>m.value.hpaMaxReplicas=a)},null,512),[[I,m.value.hpaMaxReplicas]])]),l("div",null,[e[38]||(e[38]=l("label",{class:"form-check-label mb-2"}," CPU (%) ",-1)),r(l("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"60","onUpdate:modelValue":e[14]||(e[14]=a=>m.value.hpaCpuUtilization=a)},null,512),[[I,m.value.hpaCpuUtilization]]),e[39]||(e[39]=j(" % "))]),l("div",null,[e[40]||(e[40]=l("label",{class:"form-check-label mb-2"}," MEMORY (%) ",-1)),r(l("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"80","onUpdate:modelValue":e[15]||(e[15]=a=>m.value.hpaMemoryUtilization=a)},null,512),[[I,m.value.hpaMemoryUtilization]]),e[41]||(e[41]=j(" % "))])])):b("",!0)])):b("",!0),d.value=="Application Installation"?(n(),s("div",na,[e[49]||(e[49]=l("label",{class:"form-label"},"Ingress Configuration",-1)),l("div",oa,[l("div",ia,[r(l("input",{class:"form-check-input",type:"checkbox",id:"ingressEnabled","onUpdate:modelValue":e[16]||(e[16]=a=>c.value.ingressEnabled=a)},null,512),[[H,c.value.ingressEnabled]]),e[43]||(e[43]=l("label",{class:"form-check-label",for:"ingressEnabled"}," Enable Ingress ",-1))])]),c.value.ingressEnabled?(n(),s("div",ua,[l("div",ra,[e[44]||(e[44]=l("label",{class:"form-label"},"Host",-1)),r(l("input",{type:"text",class:"form-control",placeholder:"example.com","onUpdate:modelValue":e[17]||(e[17]=a=>c.value.ingressHost=a)},null,512),[[I,c.value.ingressHost]])]),l("div",ca,[e[45]||(e[45]=l("label",{class:"form-label"},"Path",-1)),r(l("input",{type:"text",class:"form-control",placeholder:"/","onUpdate:modelValue":e[18]||(e[18]=a=>c.value.ingressPath=a)},null,512),[[I,c.value.ingressPath]])]),l("div",da,[e[46]||(e[46]=l("label",{class:"form-label"},"Ingress Class",-1)),r(l("input",{type:"text",class:"form-control",placeholder:"nginx","onUpdate:modelValue":e[19]||(e[19]=a=>c.value.ingressClass=a)},null,512),[[I,c.value.ingressClass]])]),l("div",pa,[l("div",ma,[r(l("input",{class:"form-check-input",type:"checkbox",id:"ingressTlsEnabled","onUpdate:modelValue":e[20]||(e[20]=a=>c.value.ingressTlsEnabled=a)},null,512),[[H,c.value.ingressTlsEnabled]]),e[47]||(e[47]=l("label",{class:"form-check-label",for:"ingressTlsEnabled"}," Enable TLS ",-1))])]),c.value.ingressTlsEnabled?(n(),s("div",va,[e[48]||(e[48]=l("label",{class:"form-label"},"TLS Secret Name",-1)),r(l("input",{type:"text",class:"form-control",placeholder:"tls-secret","onUpdate:modelValue":e[21]||(e[21]=a=>c.value.ingressTlsSecret=a)},null,512),[[I,c.value.ingressTlsSecret]])])):b("",!0)])):b("",!0)])):b("",!0)],64)):b("",!0)]),l("div",ba,[l("a",{class:"btn btn-link link-secondary","data-bs-dismiss":"modal",onClick:P}," Cancel "),l("div",null,[d.value=="Application Installation"?(n(),s("button",{key:0,class:"btn btn-danger ms-auto me-1",onClick:Z,disabled:!w.value}," Spec Check ",8,fa)):b("",!0),l("button",{class:"btn btn-primary ms-auto","data-bs-dismiss":"modal",onClick:X,disabled:w.value}," Deploy ",8,ga)])])])])]))}}),Ka=ie(ha,[["__scopeId","data-v-f93d99a5"]]);export{Ka as A,Sa as I,fe as a,$a as b,Ta as c,Ea as d,Va as e,La as f,za as g,_a as h,Na as i,Pa as j,Ra as k,pe as l,xa as m,Ua as n,Ha as o,Fa as p,Aa as q,ve as r,Da as s,Ma as u};

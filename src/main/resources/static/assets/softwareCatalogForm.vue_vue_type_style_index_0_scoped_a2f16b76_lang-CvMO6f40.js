import{c as Z}from"./IconPlus-bpW_DPsb.js";import{d as ee,u as te,c as ae,r,o as le,a as s,b as a,t as p,j as k,e as m,v as f,F as b,f as w,g as $,p as z,h as n}from"./index-DzJ3jzpJ.js";import{_ as se}from"./lodash-BYSfiGoO.js";import{s as c}from"./request-Bw22LZde.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";/**
 * @license @tabler/icons-vue v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var rt=Z("outline","dots","IconDots",[["path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]);const oe=()=>c.get("/cbtumblebug/ns"),ie=l=>c.get(`/cbtumblebug/ns/${l}/mci`),ue=l=>c.get(`/cbtumblebug/ns/${l.nsId}/mci/${l.mciId}`),ce=l=>c.get(`/cbtumblebug/ns/${l}/k8scluster`),re=l=>c.get(`/catalog/software/?title=${l}`),dt=l=>c.get(`/catalog/software/${l}`),mt=l=>c.get(`/search/dockerhub/${l}`),pt=l=>c.get(`/search/artifacthub/${l}`),de=l=>c.get(`/applications/vm/deploy?namespace=${l.namespace}&mciId=${l.mciId}&vmId=${l.vmId}&catalogId=${l.catalogId}&servicePort=${l.servicePort}`),me=l=>c.get(`/applications/vm/action?operation=${l.operation}&applicationStatusId=${l.applicationStatusId}&reason=${l.reason}`),pe=l=>c.get(`/applications/k8s/deploy?namespace=${l.namespace}&clusterName=${l.clusterName}&catalogId=${l.catalogId}`),ve=l=>c.get(`/applications/k8s/action?operation=${l.operation}&applicationStatusId=${l.applicationStatusId}&reason=${l.reason}`),fe=l=>c.get(`/applications/vm/check?namespace=${l.namespace}&mciId=${l.mciName}&vmId=${l.vmName}&catalogId=${l.catalogId}`),be=l=>c.get(`/applications/k8s/check?namespace=${l.namespace}&clusterName=${l.clusterName}&catalogId=${l.catalogId}`),vt=l=>c.get(`/ape/log/${l}`);function ft(l){return c.post("/catalog/software",l)}function bt(l){return c.put("/catalog/software",l)}function gt(){return c.get("/applications/groups")}const ge={class:"modal fade",id:"install-form",tabindex:"-1"},he={class:"modal-dialog modal-lg",role:"document"},Ie={class:"modal-content"},ye={class:"modal-header"},ke={class:"modal-title"},we={class:"modal-body",style:{"max-height":"calc(100vh - 200px)","overflow-y":"auto"}},Ce={class:"mb-3"},Se={key:0,class:"text-muted"},Ve={key:1,class:"text-muted"},Ue=["value"],Ne={class:"mb-3"},Me={key:0,class:"text-muted"},$e={key:1,class:"text-muted"},Ae=["value"],_e={value:"selectNsId"},xe={class:"mb-3"},Le={key:0,class:"text-muted"},Pe={key:1,class:"text-muted"},Re=["disabled"],Ee=["value"],Fe={class:"mb-3"},Ke=["disabled"],De=["value"],Te={class:"mb-3"},Be={class:"mb-3"},ze={class:"mb-3"},je={key:0,class:"text-muted"},qe={key:1,class:"text-muted"},He=["value"],Ye={value:"selectNsId"},Oe={class:"mb-3"},We={key:0,class:"text-muted"},Ge={key:1,class:"text-muted"},Je=["disabled"],Qe=["value"],Xe={class:"mb-3"},Ze={key:0,class:"mb-3"},et={class:"d-flex justigy-content-between"},tt={class:"modal-footer d-flex justify-content-between"},at=["disabled"],lt=["disabled"],st=ee({__name:"applicationInstallationForm",props:{nsId:{},title:{}},setup(l){const h=te(),j=l,u=ae(()=>j.title),F=r([]),C=r([]),N=r([]),L=r([]),A=r([]),d=r(""),i=r(""),v=r(""),I=r(""),g=r({}),_=r([]),S=r(""),V=r(""),P=r(""),y=r(!0);le(async()=>{document.getElementById("install-form").addEventListener("show.bs.modal",async()=>{await R(),await q()})});const R=async()=>{d.value="",i.value="",v.value="",I.value="",g.value={},H(),Y(),await O()},q=async()=>{await re("").then(({data:o})=>{A.value=o})},H=()=>{F.value=[{key:"VM",value:"VM"},{key:"k8s",value:"K8S"}]},Y=()=>{u.value==="Application Uninstallation"?y.value=!1:y.value=!0},O=async()=>{await oe().then(async({data:o})=>{C.value=o,C.value.length>0&&(i.value=C.value[0].name),se.isEmpty(i.value)||(d.value==="VM"?await K():d.value==="K8S"&&await T())})},K=async()=>{await ie(i.value).then(async({data:o})=>{N.value=o,N.value.length>0?(v.value=N.value[0].name,await D()):v.value=""})},D=async()=>{const o={nsId:i.value,mciId:v.value};await ue(o).then(({data:e})=>{L.value=e.vm,N.value.length>0?I.value=L.value[0].name:I.value=""})},T=async()=>{await ce(i.value).then(({data:o})=>{_.value=o,_.value.length>0?S.value=_.value[0].name:S.value=""})},E=async()=>{await K(),x()},W=async()=>{await D(),x()},G=async()=>{await T(),x()},x=()=>{u.value==="Application Installation"?y.value=!0:u.value==="Application Uninstallation"&&(y.value=!1)},J=async()=>{let o={},e={};d.value==="VM"?(V.value.split(",").map(t=>t.toLowerCase().trim()),o={namespace:i.value,mciId:v.value,vmId:I.value,catalogId:U.value,servicePort:P.value},u.value=="Application Installation"?e=await de(o):e=await me(o),e.data?h.success("SUCCESS"):h.error("FAIL")):d.value==="K8S"&&(V.value.split(",").map(t=>t.toLowerCase().trim()),o={namespace:i.value,clusterName:S.value,catalogId:U.value},u.value=="Application Installation"?e=await pe(o):e=await ve(o),e.data?h.success("SUCCESS"):h.error("FAIL"))},Q=async()=>{d.value==="VM"||d.value==="K8S"?X().then(o=>{let e=!0;if(o===null){h.error("Please select all items");return}else if(o===!1){let t="";d.value==="VM"?t="VM":d.value==="K8S"&&(t="CLUSTER");const M="Your selected "+t+" has lower specifications than recommended. Would you like to continue with the installation?";e=confirm(M)}e&&(h.success("Please click RUN"),y.value=!1)}):h.error("Please Select Infra")},X=async()=>{let o=!1;if(d.value==="VM"){if(i.value===""||v.value===""||I.value===""||U.value===0)return null;{const e={namespace:i.value,mciName:v.value,vmName:I.value,catalogId:U.value};await fe(e).then(({data:t})=>{o=t})}}else if(d.value==="K8S"){if(i.value===""||S.value===""||U.value===0){h.error("Please select all items");return}const e={namespace:i.value,clusterName:S.value,catalogId:U.value};await be(e).then(({data:t})=>{o=t})}return o},U=r(0),B=()=>{u.value==="Application Installation"&&(y.value=!0),A.value.forEach(o=>{if(V.value===o.title){U.value=o.id;return}})};return(o,e)=>(n(),s("div",ge,[a("div",he,[a("div",Ie,[a("div",ye,[a("h5",ke,p(u.value),1),a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:R})]),a("div",we,[a("div",Ce,[e[15]||(e[15]=a("label",{class:"form-label"},"Target Infra",-1)),u.value=="Application Installation"?(n(),s("p",Se," Select the Infra what is the Infra will be installed ")):u.value=="Application Uninstallation"?(n(),s("p",Ve," Select the Infra what is the Infra will be uninstalled ")):k("",!0),m(a("select",{class:"form-select",id:"infra","onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),onClick:x},[(n(!0),s(b,null,w(F.value,t=>(n(),s("option",{value:t.value,key:t.value},p(t.value),9,Ue))),128))],512),[[f,d.value]])]),d.value=="VM"?(n(),s(b,{key:0},[a("div",Ne,[e[16]||(e[16]=a("label",{class:"form-label"},"Namespace",-1)),u.value=="Application Installation"?(n(),s("p",Me," Select the namespace where the application will be installed")):u.value=="Application Uninstallation"?(n(),s("p",$e," Select the namespace where the application will be uninstalled")):k("",!0),C.value.length>0?m((n(),s("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[1]||(e[1]=t=>i.value=t),onChange:E},[(n(!0),s(b,null,w(C.value,t=>(n(),s("option",{value:t.name,key:t.name},p(t.name),9,Ae))),128))],544)),[[f,i.value]]):m((n(),s("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[2]||(e[2]=t=>i.value=t),onChange:E},[a("option",_e,p(i.value),1)],544)),[[f,i.value]])]),a("div",xe,[e[17]||(e[17]=a("label",{class:"form-label"},"MCI Name",-1)),u.value=="Application Installation"?(n(),s("p",Le," Select the multi-cloud infrastructure information where the application will be deployed")):u.value=="Application Uninstallation"?(n(),s("p",Pe," Remove the application and associated resources from the multi-cloud infrastructure")):k("",!0),m(a("select",{class:"form-select",id:"mci-name",disabled:i.value=="","onUpdate:modelValue":e[3]||(e[3]=t=>v.value=t),onChange:W},[(n(!0),s(b,null,w(N.value,t=>(n(),s("option",{value:t.id,key:t.name},p(t.name),9,Ee))),128))],40,Re),[[f,v.value]])]),a("div",Fe,[e[18]||(e[18]=a("label",{class:"form-label"},"VM Name",-1)),e[19]||(e[19]=a("p",{class:"text-muted"}," Select the virtual machine (VM) within the chosen multi-cloud infrastructure where the application will be deployed",-1)),m(a("select",{class:"form-select",id:"mci-name",disabled:v.value=="","onUpdate:modelValue":e[4]||(e[4]=t=>I.value=t)},[(n(!0),s(b,null,w(L.value,t=>(n(),s("option",{value:t.id,key:t.name},p(t.name),9,De))),128))],8,Ke),[[f,I.value]])]),a("div",Te,[e[20]||(e[20]=a("label",{class:"form-label"},"Application",-1)),e[21]||(e[21]=a("p",{class:"text-muted"},"Select the application",-1)),m(a("select",{class:"form-select","onUpdate:modelValue":e[5]||(e[5]=t=>V.value=t),onChange:B},[(n(!0),s(b,null,w(A.value,(t,M)=>(n(),s("option",{key:M},p(t.title),1))),128))],544),[[f,V.value]])]),a("div",Be,[e[22]||(e[22]=a("label",{class:"form-label"},"Port",-1)),e[23]||(e[23]=a("p",{class:"text-muted"},"Please enter a port accessible from the outside",-1)),m(a("input",{type:"number",class:"form-control",placeholder:"8080","onUpdate:modelValue":e[6]||(e[6]=t=>P.value=t)},null,512),[[$,P.value]])])],64)):d.value=="K8S"?(n(),s(b,{key:1},[a("div",ze,[e[24]||(e[24]=a("label",{class:"form-label"},"Namespace",-1)),u.value=="Application Installation"?(n(),s("p",je,"Select the namespace where the application will be installed")):u.value=="Application Uninstallation"?(n(),s("p",qe,"Select the namespace where the application will be uninstalled")):k("",!0),C.value.length>0?m((n(),s("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[7]||(e[7]=t=>i.value=t),onChange:G},[(n(!0),s(b,null,w(C.value,t=>(n(),s("option",{value:t.name,key:t.name},p(t.name),9,He))),128))],544)),[[f,i.value]]):m((n(),s("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[8]||(e[8]=t=>i.value=t),onChange:E},[a("option",Ye,p(i.value),1)],544)),[[f,i.value]])]),a("div",Oe,[e[25]||(e[25]=a("label",{class:"form-label"},"ClusterName",-1)),u.value=="Application Installation"?(n(),s("p",We,"Select the name of the cluster where the application will be deployed")):u.value=="Application Uninstallation"?(n(),s("p",Ge,"Remove the application and associated resources from the multi-cloud infrastructure")):k("",!0),m(a("select",{class:"form-select",id:"mci-name",disabled:i.value=="","onUpdate:modelValue":e[9]||(e[9]=t=>S.value=t)},[(n(!0),s(b,null,w(_.value,t=>(n(),s("option",{value:t.id,key:t.name},p(t.name),9,Qe))),128))],8,Je),[[f,S.value]])]),a("div",Xe,[e[26]||(e[26]=a("label",{class:"form-label"},"Helm chart",-1)),e[27]||(e[27]=a("p",{class:"text-muted"},"Select the application",-1)),m(a("select",{class:"form-select","onUpdate:modelValue":e[10]||(e[10]=t=>V.value=t),onChange:B},[(n(!0),s(b,null,w(A.value,(t,M)=>(n(),s("option",{key:M},p(t.title),1))),128))],544),[[f,V.value]])]),u.value=="Application Installation"?(n(),s("div",Ze,[e[34]||(e[34]=a("label",{class:"form-label"},"HPA",-1)),a("div",et,[a("div",null,[e[28]||(e[28]=a("label",{class:"form-label required"}," minReplicas ",-1)),m(a("input",{type:"number",class:"form-control w-90-per",placeholder:"1","onUpdate:modelValue":e[11]||(e[11]=t=>g.value.hpaMinReplicas=t)},null,512),[[$,g.value.hpaMinReplicas]])]),a("div",null,[e[29]||(e[29]=a("label",{class:"form-label required"}," maxReplicas ",-1)),m(a("input",{type:"number",class:"form-control w-90-per",placeholder:"10","onUpdate:modelValue":e[12]||(e[12]=t=>g.value.hpaMaxReplicas=t)},null,512),[[$,g.value.hpaMaxReplicas]])]),a("div",null,[e[30]||(e[30]=a("label",{class:"form-check-label mb-2"}," CPU (%) ",-1)),m(a("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"60","onUpdate:modelValue":e[13]||(e[13]=t=>g.value.hpaCpuUtilization=t)},null,512),[[$,g.value.hpaCpuUtilization]]),e[31]||(e[31]=z(" % "))]),a("div",null,[e[32]||(e[32]=a("label",{class:"form-check-label mb-2"}," MEMORY (%) ",-1)),m(a("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"80","onUpdate:modelValue":e[14]||(e[14]=t=>g.value.hpaMemoryUtilization=t)},null,512),[[$,g.value.hpaMemoryUtilization]]),e[33]||(e[33]=z(" % "))])])])):k("",!0)],64)):k("",!0)]),a("div",tt,[a("a",{class:"btn btn-link link-secondary","data-bs-dismiss":"modal",onClick:R}," Cancel "),a("div",null,[u.value=="Application Installation"?(n(),s("button",{key:0,class:"btn btn-danger ms-auto me-1",onClick:Q,disabled:!y.value}," Spec Check ",8,at)):k("",!0),a("button",{class:"btn btn-primary ms-auto","data-bs-dismiss":"modal",onClick:J,disabled:y.value}," RUN ",8,lt)])])])])]))}}),ht=ne(st,[["__scopeId","data-v-9f5f8c89"]]);export{ht as A,rt as I,ve as a,dt as b,ft as c,re as d,pt as e,vt as f,gt as g,me as r,mt as s,bt as u};

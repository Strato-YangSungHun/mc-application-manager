import{M as $,_ as V}from"./bootstrap.esm-CCR_HJkr.js";import{_ as T}from"./Tabulator.vue_vue_type_style_index_0_lang-DmhILGHy.js";import{g as B,r as L,u as M,d as q,a as A}from"./repository-_V19v2lX.js";import{d as D,u as x,r as p,c as E,w as S,o as U,a as N,b as e,t as C,e as v,g as I,x as k,h as F,D as _,i as P}from"./index-EfFYqPyz.js";const G={class:"modal-dialog modal-lg",role:"document"},H={class:"modal-content"},O={class:"modal-header"},j={class:"modal-title"},z={class:"modal-body py-4"},J={class:"row mb-3"},K=["disabled"],Q={class:"mb-3"},W={class:"form-check form-check-inline"},X=["disabled"],Y={class:"form-check form-check-inline"},Z=["disabled"],ee={class:"mb-3"},te={class:"form-check form-check-inline"},oe={class:"form-check form-check-inline"},le={class:"form-check form-check-inline"},ae={class:"mb-3"},se={class:"form-check form-check-inline"},ne={class:"form-check form-check-inline"},re={class:"modal-footer"},ie=D({__name:"repositoryForm",props:{mode:{},repositoryName:{}},emits:["get-repository-list"],setup(g,{emit:h}){const a=x(),m=p(),c=p(),i=g,y=h,n=E(()=>i.repositoryName);S(n,async()=>{await w()}),U(async()=>{m.value&&(c.value=new $(m.value)),await w()});const o=p({}),u=p(""),b=p(0),f=p(0),w=async()=>{if(i.mode==="new")o.value.name="",o.value.format="helm",o.value.type="hosted",o.value.url="",o.value.online=!0,b.value=0,f.value=0,u.value="allow";else{const{data:l}=await B("nexus",i.repositoryName);o.value=l,u.value=l.storage.writePolicy,l.format=="docker"&&(b.value=l.docker.httpPort,f.value=l.docker.httpsPort)}},r=async()=>{if(!o.value.name||o.value.name.trim()===""){a.error("Please enter repository name.");return}if(!o.value.format){a.error("Please select format.");return}if(!u.value){a.error("Please select allow policy.");return}if(o.value.online===void 0||o.value.online===null){a.error("Please select online/offline status.");return}if(o.value.format==="docker"){if(!b.value||b.value<=0){a.error("Please enter valid HTTP port.");return}if(!f.value||f.value<=0){a.error("Please enter valid HTTPS port.");return}}o.value.storage={blobStoreName:"default",strictContentTypeValidation:!0,writePolicy:u.value},o.value.format!="docker"?o.value.docker={}:o.value.docker={v1Enabled:!0,forceBasicAuth:!0,httpPort:b.value,httpsPort:f.value,subdomain:"/test"};let l=!1;i.mode==="new"?l=await d():l=await R(),l&&(y("get-repository-list"),w(),c.value&&(c.value.hide(),setTimeout(()=>{document.body.classList.remove("modal-open");const t=document.querySelector(".modal-backdrop");t==null||t.remove()},150)))},d=async()=>{try{const{data:l}=await L("nexus",o.value);return l?(a.success("Repository created successfully."),!0):(a.error("Failed to create repository."),!1)}catch{return a.error("Failed to create repository."),!1}},R=async()=>{try{const{data:l}=await M("nexus",o.value);return l?(a.success("Repository updated successfully."),!0):(a.error("Failed to update repository."),!1)}catch{return a.error("Failed to update repository."),!1}};return(l,t)=>(F(),N("div",{class:"modal fade",id:"repositoryForm",tabindex:"-1",ref_key:"modalElement",ref:m},[e("div",G,[e("div",H,[e("div",O,[e("h3",j,"Repository "+C(i.mode==="new"?"Create":"Update"),1),t[10]||(t[10]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",z,[e("div",null,[e("div",J,[t[11]||(t[11]=e("label",{class:"form-label required"},"Name",-1)),v(e("input",{type:"text",class:"form-control p-2 g-col-11","onUpdate:modelValue":t[0]||(t[0]=s=>o.value.name=s),disabled:i.mode!="new",placeholder:"Enter repository name"},null,8,K),[[I,o.value.name]])]),e("div",Q,[t[14]||(t[14]=e("label",{class:"form-label required"},"Format",-1)),e("div",null,[e("label",W,[v(e("input",{class:"form-check-input",type:"radio",name:"format",value:"helm","onUpdate:modelValue":t[1]||(t[1]=s=>o.value.format=s),disabled:i.mode!="new"},null,8,X),[[k,o.value.format]]),t[12]||(t[12]=e("span",{class:"form-check-label"},"helm",-1))]),e("label",Y,[v(e("input",{class:"form-check-input",type:"radio",name:"format",value:"docker","onUpdate:modelValue":t[2]||(t[2]=s=>o.value.format=s),disabled:i.mode!="new"},null,8,Z),[[k,o.value.format]]),t[13]||(t[13]=e("span",{class:"form-check-label"},"docker",-1))])])]),e("div",ee,[t[18]||(t[18]=e("label",{class:"form-label required"},"Allow",-1)),e("div",null,[e("label",te,[v(e("input",{class:"form-check-input",type:"radio",name:"allow",value:"allow","onUpdate:modelValue":t[3]||(t[3]=s=>u.value=s)},null,512),[[k,u.value]]),t[15]||(t[15]=e("span",{class:"form-check-label"},"allow",-1))]),e("label",oe,[v(e("input",{class:"form-check-input",type:"radio",name:"allow",value:"allow_once","onUpdate:modelValue":t[4]||(t[4]=s=>u.value=s)},null,512),[[k,u.value]]),t[16]||(t[16]=e("span",{class:"form-check-label"},"allow_once",-1))]),e("label",le,[v(e("input",{class:"form-check-input",type:"radio",name:"allow",value:"deny","onUpdate:modelValue":t[5]||(t[5]=s=>u.value=s)},null,512),[[k,u.value]]),t[17]||(t[17]=e("span",{class:"form-check-label"},"deny",-1))])])]),e("div",ae,[t[21]||(t[21]=e("label",{class:"form-label required"},"On/Offline",-1)),e("div",null,[e("label",se,[v(e("input",{class:"form-check-input",type:"radio",name:"online",value:"true","onUpdate:modelValue":t[6]||(t[6]=s=>o.value.online=s)},null,512),[[k,o.value.online]]),t[19]||(t[19]=e("span",{class:"form-check-label"},"true",-1))]),e("label",ne,[v(e("input",{class:"form-check-input",type:"radio",name:"online",value:"false","onUpdate:modelValue":t[7]||(t[7]=s=>o.value.online=s)},null,512),[[k,o.value.online]]),t[20]||(t[20]=e("span",{class:"form-check-label"},"false",-1))])])])])]),e("div",re,[e("button",{type:"button",class:"btn btn-link link-secondary","data-bs-dismiss":"modal",onClick:t[8]||(t[8]=s=>w())}," Cancel "),e("button",{type:"button",ref:"submitBtn",class:"btn btn-primary ms-auto",onClick:t[9]||(t[9]=s=>r())},C(i.mode==="new"?"Create":"Update"),513)])])])],512))}}),de={class:"modal fade",id:"deleteRepository",tabindex:"-1"},ue={class:"modal-dialog modal-lg",role:"document"},me={class:"modal-content"},ce={class:"modal-body text-left py-4"},pe={class:"modal-footer"},fe=D({__name:"deleteRepository",props:{repositoryName:{}},emits:["get-repository-list"],setup(g,{emit:h}){const a=x(),m=g,c=h,i=async()=>{const{data:y}=await q("nexus",m.repositoryName);y?a.success("Deleted successfully."):a.error("Failed to delete."),c("get-repository-list")};return(y,n)=>(F(),N("div",de,[e("div",ue,[e("div",me,[n[3]||(n[3]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),n[4]||(n[4]=e("div",{class:"modal-status bg-danger"},null,-1)),e("div",ce,[n[1]||(n[1]=e("h3",{class:"mb-5"}," Delete Repository ",-1)),e("h4",null,"Are you sure you want to delete "+C(m.repositoryName)+"?",1)]),e("div",pe,[n[2]||(n[2]=e("a",{href:"#",class:"btn btn-link link-secondary","data-bs-dismiss":"modal"}," Cancel ",-1)),e("a",{href:"#",class:"btn btn-primary ms-auto","data-bs-dismiss":"modal",onClick:n[0]||(n[0]=o=>i())}," Delete ")])])])]))}}),ve={class:"card card-flush w-100"},ge=D({__name:"RepositoryList",props:{embedded:{type:Boolean}},emits:["open-detail"],setup(g,{emit:h}){const a=x(),m=g,c=h,i=p([]),y=p([]);U(async()=>{u(),await n()});const n=async()=>{try{const{data:r}=await A("nexus");i.value=r}catch(r){console.log(r),a.error("Unable to fetch data.")}},o=p(""),u=()=>{y.value=[{title:"Name",field:"name",width:"15%",cellClick:function(r,d){r.stopPropagation(),o.value=d.getRow().getData().name,m.embedded?c("open-detail",o.value):_.push("/web/repository/detail/"+o.value)}},{title:"Format",field:"format",width:"10%",cellClick:function(r,d){r.stopPropagation(),o.value=d.getRow().getData().name,m.embedded?c("open-detail",o.value):_.push("/web/repository/detail/"+o.value)}},{title:"URL",field:"url",width:"40%",cellClick:function(r,d){r.stopPropagation(),o.value=d.getRow().getData().name,m.embedded?c("open-detail",o.value):_.push("/web/repository/detail/"+o.value)}},{title:"Type(hosted)",field:"type",width:"15%",cellClick:function(r,d){r.stopPropagation(),o.value=d.getRow().getData().name,m.embedded?c("open-detail",o.value):_.push("/web/repository/detail/"+o.value)}},{title:"Action",width:"20%",formatter:b,cellClick:function(r,d){const R=r.target,l=R==null?void 0:R.getAttribute("id");o.value=d.getRow().getData().name,l==="edit-btn"?f.value="edit":o.value=d.getRow().getData().name}}]},b=()=>`
  <div>
    <button
      class='btn btn-outline-primary d-none d-sm-inline-block me-1'
      id='edit-btn'
      data-bs-toggle='modal' 
      data-bs-target='#repositoryForm'>
      Update
    </button>
    <button
      class='btn btn-outline-danger d-none d-sm-inline-block'
      id='delete-btn'
      data-bs-toggle='modal' 
      data-bs-target='#deleteRepository'>
      Delete
    </button>
  </div>`,f=p("new"),w=()=>{o.value="",f.value="new"};return(r,d)=>(F(),N("div",ve,[P(V,{"header-title":"Repository","new-btn-title":"New Repository","popup-flag":!0,"popup-target":"#repositoryForm",onClickNewBtn:w}),P(T,{columns:y.value,"table-data":i.value},null,8,["columns","table-data"]),P(ie,{mode:f.value,"repository-name":o.value,onGetRepositoryList:n},null,8,["mode","repository-name"]),P(fe,{"repository-name":o.value,onGetRepositoryList:n},null,8,["repository-name"])]))}});export{ge as _};
